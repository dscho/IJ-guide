<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="generator" content="http://www.nongnu.org/elyxer/" />
	<meta name="create-date" content="2012-06-24" />
	<meta name="author" content="Tiago Ferreira" />
	<meta name="description" content="The ImageJ handbook" />
	<meta name="keywords" content="ImageJ,IJ,fiji,scientifc image processing,manual,guide" />
	<title>ImageJ User Guide - IJ 1.46r | Process Menu </title>
	<link rel="icon" type="image/x-icon" href="icons/favicon.ico" />
	<link rel="stylesheet" href="css/guide.css" type="text/css" media="all" />
	<link href="sh/styles/shCore.css" rel="stylesheet" type="text/css" />
	<link href="sh/styles/shThemeFijiEd.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/toc.js"> </script> <script type="text/javascript" src="js/searchhi.js"> </script> <script type="text/javascript" src="sh/scripts/shCore.js"></script> <script type="text/javascript" src="sh/scripts/shBrushJScript.js"></script> <script type="text/javascript" src="sh/scripts/shBrushIJmacro.js"></script> 
<script type="text/javascript">SyntaxHighlighter.defaults['toolbar']=false;SyntaxHighlighter.all();</script> 
</head>
<body onload="initialize_page();">
<noscript>
	<div id="tocMenu">
		<iframe id="tocframe" name="tocframe" src="toc.html" width="200" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe> 
	</div>
</noscript>
<div id="bodyText">

<!--[if lte IE 7]>
        <div id="upgradeBrowser">
            <span class="notify-title">You Are Using an Outdated Browser.</span> <span class="notify-close"><a href='#' onclick='javascript:document.getElementById("upgradeBrowser").style.display="none"; return false;'>x</a></span>
            This page may not display properly unless you update Internet Explorer to a <a href='http://www.microsoft.com/windows/internet-explorer/' target='_blank'>newer version</a> supporting XHTML, CSS2 and Unicode. Alternatively, you should consider upgrading to a modern web browser such as <a href='http://www.google.com/chrome' target='_blank'>Chrome</a>, <a href='http://www.firefox.com' target='_blank'>Firefox</a>, <a href='http://www.opera.com/' target='_blank'>Opera</a> or <a href='http://www.apple.com/safari/download/' target='_blank'>Safari</a>.
        </div>
        <![endif]-->
	<div id="showHideTOC">
		<span onclick="showHideTOC();"> <img src="icons/toc.png" width="13" height="13" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide" showText="Show" /> </span> <span onclick="showHideTOC();">Hide</span> 
	</div>
	<a href="http://developer.imagej.net/" target="_blank" id="imagejdev">IJ2 is out</a> 
	<div id="globalWrapper">
		<div class="topheader">
			<span class="prev"><a class="prev" name="prev" href="146-28.html">Prev</a> Sec. 28: Image<span class="menusep">▷</span></span> <span class="up"><a class="up" name="up" href="146-Part-V.html">Up</a> Part V: Menu Commands</span> <span class="next">Sec. 30: Analyze<span class="menusep">▷</span> <a class="next" name="next" href="146-30.html">Next</a></span> 
		</div>
		<h1 class="Section">
			<a class="toc" name="toc-Section-29">29</a> <span class="menuitem">Process<span class="menusep">▷</span></span><a class="Label" name="sec:Process"> </a> 
		</h1>
		<div class="Standard">
			This menu lists all commands related to image processing, including point operations, filters, and arithmetic operations between multiple images <span class="bibcites">[<a class="bibliocite" name="cite-154" href="146-References.html#biblio-154"><span class="bib-index">104</span></a>]</span>. The <span class="menuitem">File<span class="menusep">▷</span><a class="Reference" href="146-26.html#sub:OpenSamples">Open Samples<span class="menusep">▷</span>↑</a><span class="menusep">▷</span>Blobs (25K) [B]</span> image will be used in most of the illustrations of this section.
			<div class="float">
				<a class="Label" name="Figure-26"> </a>
				<div class="figure" style="max-width: 100%;">
					<img class="figure" src="images/SmoothSharpenFindEdgesEContrast.png" alt="figure images/SmoothSharpenFindEdgesEContrast.png" style="width: 860px; height: 185px;" /> 
					<div class="caption" style="text-align: center;">
						Figure 26 <b><span class="menuitem"><b>Process<span class="menusep">▷</span></b></span> submenu: <span class="menuitem"><b><a class="Reference" href="146-29.html#sub:Smooth-[S]"><span class="small"><span class="small">Smooth [S]</span></span>↓</a></b></span>, <span class="menuitem"><b><a class="Reference" href="146-29.html#sub:Sharpen"><span class="small"><span class="small">Sharpen</span></span>↓</a></b></span>, <span class="menuitem"><b><a class="Reference" href="146-29.html#sub:Find-Edges"><span class="small"><span class="small">Find Edges</span></span>↓</a></b></span> and <span class="menuitem"><b><a class="Reference" href="146-29.html#sub:Enhance-Contrast"><span class="menuitem">Enhance Contrast…</span>↓</a></b></span></b> 
					</div>
				</div>
			</div>
		</div>
		<h2 class="Subsection">
			<a class="toc" name="toc-Subsection-29.1">29.1</a> <span class="small"><span class="menuitem"><span class="small">Smooth [S]</span></span><a class="Label" name="sub:Smooth-[S]"> </a></span> 
		</h2>
		<div class="Standard">
			Blurs the active image or selection. This filter replaces each pixel with the average of its 3<span class="formula"> × </span>3 neighborhood. 
		</div>
		<h2 class="Subsection">
			<a class="toc" name="toc-Subsection-29.2">29.2</a> <span class="small"><span class="menuitem"><span class="small">Sharpen</span></span><a class="Label" name="sub:Sharpen"> </a></span> 
		</h2>
		<div class="Standard">
			Increases contrast and accentuates detail in the image or selection, but may also accentuate noise. This filter uses the following weighting factors to replace each pixel with a weighted average of the 3<span class="formula"> × </span>3 neighborhood:<span class="small"> </span> 
		</div>
		<div class="Standard">
			<span class="small">
		<div class="formula">
			<span class="array"><span class="arrayrow"> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r">  − 1 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r"> 12 </span> <span class="arraycell align-r">  − 1 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r">  − 1 </span> </span> </span> 
		</div>
		</span> 
	</div>
	<h2 class="Subsection">
		<a class="toc" name="toc-Subsection-29.3">29.3</a> <span class="small"><span class="menuitem"><span class="small">Find Edges</span></span><a class="Label" name="sub:Find-Edges"> </a></span> 
	</h2>
	<div class="Standard">
		Uses a Sobel edge detector to highlight sharp changes in intensity in the active image or selection. Two 3<span class="formula"> × </span>3 convolution kernels (shown below) are used to generate vertical and horizontal derivatives. The final image is produced by combining the two derivatives using the square root of the sum of the squares. 
	</div>
	<div class="Standard">
		<div class="center">
			<span class="small"><span class="formula"><span class="array"><span class="arrayrow"> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> 2 </span> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> 0 </span> <span class="arraycell align-r">  − 1 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r"> 0 </span> <span class="arraycell align-r"> 0 </span> <span class="arraycell align-r">  0 </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> 2 </span> <span class="arraycell align-r"> &nbsp;&nbsp;&nbsp; 0 </span> <span class="arraycell align-r">  − 2 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r">  − 2 </span> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> </span> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> 0 </span> <span class="arraycell align-r">  − 1 </span> </span> </span></span></span> 
		</div>
	</div>
	<h2 class="Subsection">
		<a class="toc" name="toc-Subsection-29.4">29.4</a> <span class="menuitem">Find Maxima…</span><a class="Label" name="sub:Find-Maxima"> </a> 
	</h2>
		<div class="minipagefloat">
			<img class="embedded" src="images/FindMaxima.png" alt="figure images/FindMaxima.png" style="width: 352px; height: 228px;" /> 
		</div>
	<div class="Standard">
		Determines the local maxima in an image and creates a binary (mask-like) image of the same size with the maxima, or one segmented particle per maximum, marked <span class="bibcites">[<a class="bibliocite" name="cite-29" href="146-References.html#biblio-29">29</a>]</span>. Analysis is performed on the existing rectangular selection or on the entire image if no selection is present. 
	</div>
	<div class="Standard">
		For RGB images, maxima of luminance are selected, with the luminance defined as weighted or unweighted average of the colors depending on how <i>Weighted RGB to Grayscale Conversion</i> is set in <span class="menuitem">Edit<span class="menusep">▷</span>Options<span class="menusep">▷</span><a class="Reference" href="146-27.html#sub:Conversions...">Conversions…↑</a></span>. 
	</div>
	<div class="Standard">
		<div class="Standard">
			<div class="Description">
				<span class="Description-entry"><i>Noise Tolerance</i></span> Maxima are ignored if they do not stand out from the surroundings by more than this value (calibrated units for calibrated images). In other words, a threshold is set at the maximum value minus noise tolerance and the contiguous area around the maximum above the threshold is analyzed. For accepting a maximum, this area must not contain any point with a value higher than the maximum. Only one maximum within this area is accepted. 
			</div>
		</div>
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Output</i> <i>Type</i></span> Can be (<i>see</i> <a class="Reference" href="146-29.html#Flo:Maxima-outputs"><span class="sans"><span class="menuitem"><span class="sans">Process<span class="menusep">▷</span>Find Maxima…</span></span></span> outputs↓</a>): 
	</div>
	<ul>
		<li class="nested"> 
		<div class="Description">
			<span class="Description-entry"><i>Single Points</i></span> Results in one single point per maximum. 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>Maxima</i> <i>Within</i> <i>Tolerance</i></span> All points within the <i>Noise Tolerance</i> for each maximum. 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>Segmented Particles</i></span> Assumes that each maximum belongs to a particle and segments the image by a watershed algorithm applied to the values of the image (in contrast to <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Watershed">Watershed↓</a></span>, which uses the Euclidian distance map — EDM<a class="NomenclatureEntry" name="noment-edm" href="146-Nomenclature.html#nom-edm">[?]</a>). See <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Voronoi">Voronoi↓</a></span> for EDM-based segmentation of binary images. 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>Point</i> <i>Selection</i></span> Displays a multi-point selection with a point at each maximum. 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>List</i></span> Displays the XY coordinates of each maximum in the Results window. 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>Count</i></span> Displays the number of maxima in the Results window. 
		</div>
		</li>
	</ul>
	<div class="Description">
		<span class="Description-entry"><i>Exclude Edge Maxima</i></span> Excludes maxima if the area within the noise tolerance surrounding a maximum touches the edge of the image (edge of the selection does not matter). 
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Above</i> <i>Lower</i> <i>Threshold</i></span> (Thresholded images only) Finds maxima above the lower threshold only. The upper threshold of the image is ignored. If <i>Segmented Particles</i> is selected as <i>Output Type</i>, the area below the lower threshold is considered a background. This option cannot be used when finding minima (image with light background and inverted LUT). 
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Light Background</i></span> To be checked if the image background is brighter than the objects to be found, as it is in the Cell Colony image in the illustration below. 
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Help</i></span> Opens <a class="URL" href="http://imagej.nih.gov/ij/docs/menus/process.html#find-maxima">http://imagej.nih.gov/ij/docs/menus/process.html#find-maxima</a>. 
	</div>
	<div class="Standard">
		<div class="float">
			<a class="Label" name="Flo:Maxima-outputs"> </a>
			<div class="figure" style="max-width: 100%;">
				<img class="figure" src="images/FindMaximaOutputTypes.png" alt="figure images/FindMaximaOutputTypes.png" style="width: 860px; height: 184px;" /> 
				<div class="caption">
					Figure 27 <span class="sans"></span><b><span class="menuitem"><b>Process<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Find-Maxima"><span class="menuitem">Find Maxima…</span>↑</a></b></span> (ImageJ 1.43s). </b>Six outputs<b> </b>are possible:<i> Single Points, Maxima Within Tolerance, Segmented Particles, Point Selection, List </i>and <i>Count.</i> 
				</div>
			</div>
		</div>
	</div>
	<div class="Standard">
		Output is a binary image, with foreground 255 and background 0, using an inverted or normal LUT depending on the <i>Black Background</i> option in <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span> (<i>see</i> <a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a>). 
	</div>
	<div class="Standard">
		The number of particles (as obtained by <span class="menuitem">Analyze<span class="menusep">▷</span><a class="Reference" href="146-30.html#sub:Analyze-Particles...">Analyze Particles…↓</a></span>) in the output image does not depend on the selected <i>Output Type</i>. Note that <i>Segmented Particles</i> will usually result in particles touching the edge if <i>Exclude Edge Maxima</i> is selected. <i>Exclude Edge Maxima</i> applies to the maximum, not to the particle. 
	</div>
	<div class="Standard">
		<span class="menuitem"><a class="Reference" href="146-29.html#sub:Find-Maxima"><span class="menuitem">Find Maxima…</span>↑</a></span> does not work on stacks, but the <a class="URL" href="http://imagej.nih.gov/ij/macros/FindStackMaxima.txt">FindStackMaxima</a> macro runs it on all the images in a stack and creates a second stack containing the output images. The <a class="URL" href="http://imagej.nih.gov/ij/macros/examples/FindMaximaRoiManager.txt">FindMaximaRoiManager</a> macro demonstrates how to add particles found by <span class="menuitem"><a class="Reference" href="146-29.html#sub:Find-Maxima"><span class="menuitem">Find Maxima…</span>↑</a></span> to the <span class="menuitem"><a class="Reference" href="146-30.html#sub:ROI-Manager..."><span class="menuitem">ROI Manager…</span>↓</a></span> 
	</div>
	<div class="Standard">
		<div class="float">
			<div class="figure">
				<table class="blank">
					<tr>
						<td align="center" valign="middle" style="width: 47%;"> 
						<div class="center">
							<img class="embedded" src="images/FindMaximaEx1.png" alt="figure images/FindMaximaEx1.png" style="width: 240px; height: 160px;" /> 
						</div>
						</td>
						<td align="center" valign="middle" style="width: 47%;"> 
						<div class="center">
							<img class="embedded" src="images/FindMaximaEx2.png" alt="figure images/FindMaximaEx2.png" style="width: 240px; height: 160px;" /> 
						</div>
						</td>
					</tr>
					<tr>
						<td align="center" valign="middle" style="width: 47%;"> <span class="footnotesize">Points at maxima (Multi-point selection) </span> </td>
						<td align="center" valign="middle" style="width: 47%;"> <span class="footnotesize">Segmented Particles<i> </i>(ROIs obtained with Analyze<span class="menusep">▷</span><a class="Reference" href="146-30.html#sub:Analyze-Particles...">Analyze Particles…↓</a>)</span> </td>
					</tr>
				</table>
			</div>
		</div>
	</div>
	<h2 class="Subsection">
		<a class="toc" name="toc-Subsection-29.5">29.5</a> <span class="menuitem">Enhance Contrast…</span><a class="Label" name="sub:Enhance-Contrast"> </a> 
	</h2>
	<div class="Standard">
		<div class="minipagefloat">
			<img class="embedded" src="images/EnhanceContrast.png" alt="figure images/EnhanceContrast.png" style="width: 184px; height: 156px;" /> 
		</div>
		<div class="Standard">
			Enhances image contrast by using either histogram stretching or histogram equalization. Both methods are described in detail in the <a class="URL" href="http://homepages.inf.ed.ac.uk/rbf/HIPR2/">Hypermedia Image Processing Reference</a><a class="NomenclatureEntry" name="noment-hipr" href="146-Nomenclature.html#nom-hipr">[?]</a> — <a class="URL" href="http://homepages.inf.ed.ac.uk/rbf/HIPR2/stretch.htm#1">Contrast Stretching</a> and <a class="URL" href="http://homepages.inf.ed.ac.uk/rbf/HIPR2/histeq.htm#1">Histogram Equalization</a>.
			<div class="medskip">
			</div>
			This command does not alter pixel values as long as <i>Normalize</i>, <i>Equalize Histogram</i> or <i>Normalize All n Slices</i> (in the case of stacks) are not checked. 
		</div>
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Saturated Pixels</i></span> Determines the number of pixels in the image that are allowed to become saturated. Increasing this value will increase contrast. This value should be greater than zero to prevent a few outlying pixel from causing the histogram stretch to not work as intended. 
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Normalize</i></span> If checked, ImageJ will recalculate the pixel values of the image so the range is equal to the maximum range for the data type, or 0--1.0 for float images. The contrast stretch performed on the image is similar to the &lsquo;<i>Auto</i>&rsquo; option in the <span class="menuitem"><a class="Reference" href="146-28.html#sub:Brightness/Contrast...[C]">Brightness/Contrast… [C]↑</a></span> window, except that with stacks, each slice in the stack is adjusted independently, according to the optimal for that slice alone (if <i>Use Stack Histogram</i> is unchecked). The maximum range is 0--255 for 8-bit images and 0--65535 for 16-bit images.<br />
		With stacks another checkbox<i>, Normalize All n Slices</i>, is displayed. If checked, normalization will be applied to all slices in the stack. Note that normalization of RGB images is not supported, and thus this option will not be available on RGB stacks. 
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Equalize Histogram</i></span> If checked, ImageJ will enhance the image using histogram equalization <span class="bibcites">[<a class="bibliocite" name="cite-30" href="146-References.html#biblio-30">30</a>]</span>. Create a selection and the equalization will be based on the histogram of that selection. Uses a modified algorithm that takes the square root of the histogram values. Hold <span class="Keystroke">Alt</span> to use the standard histogram equalization algorithm. The <i>Saturated Pixels</i> and <i>Normalize</i> parameters are ignored when <i>Equalize Histogram</i> is checked. 
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Use</i> <i>Stack</i> <i>Histogram</i></span> If checked, ImageJ will use the overall stack histogram instead of individual slice histograms, that allow optimal adjustments for each slice alone. This option may be specially relevant when performing enhancements based on a ROI. 
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Help</i></span> Opens <a class="FlexURL" href="http://imagej.nih.gov/ij/docs/menus/process.html#enhance">http://imagej.nih.gov/ij/docs/menus/process.html#enhance</a>. 
	</div>
	<div class="See">
		<span class="menuitem"><a class="Reference" href="146-28.html#sub:Brightness/Contrast...[C]">Brightness/Contrast… [C]↑</a></span> , <a class="Reference" href="146-28.html#infobox:AutoB&C-stacks">15: Applying Auto Brightness/Contrast to Entire Stacks↑</a> 
	</div>
	<h2 class="Subsection">
		<a class="toc" name="toc-Subsection-29.6">29.6</a> <span class="menuitem">Noise<span class="menusep">▷</span></span> 
	</h2>
	<div class="Standard">
		Use the commands in this submenu to add noise to images or remove it.
		<div class="float">
			<a class="Label" name="Figure-29"> </a>
			<div class="figure" style="max-width: 100%;">
				<img class="figure" src="images/Noise.png" alt="figure images/Noise.png" style="width: 860px; height: 185px;" /> 
				<div class="caption" style="text-align:center;">
					Figure 29 <b><span class="menuitem"><b>Process<span class="menusep">▷</span>Noise<span class="menusep">▷</span></b></span>: <span class="menuitem"><b><a class="Reference" href="146-29.html#sub:Salt-and-Pepper">Salt and Pepper↓</a></b></span>, <span class="menuitem"><b><a class="Reference" href="146-29.html#sub:Despeckle"><span class="menuitem">Despeckle</span>↓</a></b></span>, <span class="menuitem"><b><a class="Reference" href="146-29.html#sub:Add-Noise">Add Noise↓</a></b></span> and <span class="menuitem"><b><a class="Reference" href="146-29.html#sub:Remove-Outliers..."><span class="menuitem">Remove Outliers…</span>↓</a></b></span></b> 
				</div>
			</div>
		</div>
	</div>
	<div class="See">
		<a class="URL" href="www.imagescience.org/meijering/software/randomj/">RandomJ (Binomial, Exponential, Gamma, Gaussian, Poisson and Uniform)</a> a Java package for image randomization by Erik Meijering 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.6.1">29.6.1</a> <span class="menuitem">Add Noise</span><a class="Label" name="sub:Add-Noise"> </a> 
	</h3>
	<div class="Standard">
		Adds random noise to the image or selection. The noise is Gaussian (normally) distributed with a mean of zero and standard deviation of 25. 
	</div>
	<div class="See">
		<span class="menuitem">Filters<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Gaussian-Blur..."><span class="menuitem">Gaussian Blur…</span>↓</a></span> 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.6.2">29.6.2</a> <span class="menuitem">Add Specified Noise…</span><a class="Label" name="sub:Add-Specified-Noise..."> </a> 
	</h3>
	<div class="Standard">
		<div class="minipagefloat">
			<img class="embedded" src="images/AddSpecifiedNoise.png" alt="figure images/AddSpecifiedNoise.png" style="width: 172px; height: 92px;" /> 
		</div>
		<div class="Standard">
			Adds Gaussian noise with a mean of zero and a chosen standard deviation.
			<div class="See">
				<span class="menuitem">Filters<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Gaussian-Blur..."><span class="menuitem">Gaussian Blur…</span>↓</a></span> 
			</div>
		</div>
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.6.3">29.6.3</a> <span class="menuitem">Salt and Pepper</span><a class="Label" name="sub:Salt-and-Pepper"> </a> 
	</h3>
	<div class="Standard">
		Adds <i>salt and pepper</i> noise to the image or selection by randomly replacing 2.5% of the pixels with black pixels and 2.5% with white pixels. This command only works with 8-bit images. 
	</div>
	<div class="See">
		<a class="Reference" href="146-19.html#sub:SprayCan">Spray Can↑</a>, <span class="menuitem">Filters<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Gaussian-Blur..."><span class="menuitem">Gaussian Blur…</span>↓</a></span> 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.6.4">29.6.4</a> <span class="menuitem">Despeckle</span><a class="Label" name="sub:Despeckle"> </a> 
	</h3>
	<div class="Standard">
		This is a median filter. It replaces each pixel with the median value in its 3<span class="formula"> × </span>3 neighborhood. This is a time consuming operation because, for each pixel in the selection, the nine pixels in the 3<span class="formula"> × </span>3 neighborhood must be sorted and the center pixel replaced with the median value (the fifth). Median filters are good at removing <i>salt and pepper </i>noise. 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.6.5">29.6.5</a> <span class="menuitem">Remove Outliers…</span><a class="Label" name="sub:Remove-Outliers..."> </a> 
	</h3>
	<div class="Standard">
		<div class="minipagefloat">
			<img class="embedded" src="images/RemoveOutliers.png" alt="figure images/RemoveOutliers.png" style="width: 184px; height: 157px;" /> 
		</div>
		<div class="Standard">
			Replaces a pixel by the median of the pixels in the surrounding if it deviates from the median by more than a certain value (the threshold). Useful for correcting, e.g., hot pixels or dead pixels of a CCD camera.
			<div class="Description">
				<span class="Description-entry"><i>Radius</i></span> Determines the area (uncalibrated, i.e., in pixels) used for calculating the median. Run <span class="menuitem">Process<span class="menusep">▷</span>Filters<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Show-Circular-Masks...">Show Circular Masks…↓</a></span> to see how radius translates into an area. 
			</div>
		</div>
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Threshold</i></span> Determines by how much the pixel must deviate from the median to get replaced, in raw (uncalibrated) units. 
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Which Outliers</i></span> Determines whether pixels brighter or darker than the surrounding (the median) should be replaced. 
	</div>
	<div class="See">
		<span class="menuitem"><a class="Reference" href="146-29.html#sub:Despeckle"><span class="menuitem">Despeckle</span>↑</a></span> 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.6.6">29.6.6</a> <span class="menuitem">Remove NaNs…</span><a class="Label" name="sub:Remove-NaNs..."> </a> 
	</h3>
	<div class="Standard">
		<div class="minipagefloat">
			<img class="embedded" src="images/RemoveNaNs.png" alt="figure images/RemoveNaNs.png" style="width: 176px; height: 96px;" /> 
		</div>
		<div class="Standard">
			This filter replaces NaN (Not-a-Number) pixels in 32-bit (float) images by the median of the neighbors inside the circular kernel area defined by <i>Radius</i> <span class="bibcites">[<a class="bibliocite" name="cite-31" href="146-References.html#biblio-31">31</a>]</span>. It does not remove patches of NaNs larger than the kernel size, however. 
		</div>
		<div class="medskip">
		</div>
	</div>
	<div class="Standard">
		Note that some ImageJ filters, such as <span class="menuitem">Process<span class="menusep">▷</span>Filters<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Gaussian-Blur..."><span class="menuitem">Gaussian Blur…</span>↓</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Mean..."><span class="menuitem">Mean…</span>↓</a></span>, and <span class="menuitem"><a class="Reference" href="146-29.html#sub:Variance..."><span class="menuitem">Variance…</span>↓</a></span> destroy the surrounding of NaN pixels by setting it also to NaN. Other filters may produce invalid results in the position of NaN pixels. 
	</div>
	<div class="See">
		<a class="URL" href="http://imagej.nih.gov/ij/macros/examples/NaNs.txt">NaNs.txt</a>, a macro that demonstrates how to create, count and remove NaNs 
	</div>
	<h2 class="Subsection">
		<a class="toc" name="toc-Subsection-29.7">29.7</a> <span class="menuitem">Shadows<span class="menusep">▷</span></span><a class="Label" name="sub:Shadows"> </a> 
	</h2>
	<div class="Standard">
		Commands in this submenu produce a shadow effect, with light appearing to come from a direction corresponding to the command name (<span class="menuitem">East</span>, <span class="menuitem">North</span>, <span class="menuitem">Northeast</span>, <span class="menuitem">Northwest</span>, <span class="menuitem">South</span>, <span class="menuitem">Southeast</span>, <span class="menuitem">Southwest</span> and <span class="menuitem">West</span>). The commands use Convolve <span class="formula">3 × 3</span>, ImageJ’s <span class="formula">3 × 3</span> convolution function. The <span class="menuitem">Shadows Demo</span> command uses all eight kernels to demonstrate the speed of Convolve <span class="formula">3 × 3</span>. The illustration below shows four of the <span class="menuitem">Shadows</span> convolution kernels. 
		<div class="float">
			<a class="Label" name="Figure-30"> </a>
			<div class="figure" style="max-width: 100%;">
				<table class="blank">
					<tr>
						<td align="center" valign="middle" style="width: 172px;"> 
						<div class="center">
							<span class="scriptsize">Original</span> 
						</div>
						</td>
						<td align="center" valign="middle" style="width: 172px;"> <span class="tiny"><span class="formula"><span class="array"><span class="arrayrow"> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> 2 </span> <span class="arraycell align-r"> 1 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r"> 0 </span> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> 0 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r">  − 2 </span> <span class="arraycell align-r">  − 1 </span> </span> </span></span></span> </td>
						<td align="center" valign="middle" style="width: 172px;"> <span class="tiny"><span class="formula"><span class="array"><span class="arrayrow"> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r">  − 2 </span> <span class="arraycell align-r">  − 1 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r"> 0 </span> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> 0 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> 2 </span> <span class="arraycell align-r"> 1 </span> </span> </span></span></span> </td>
						<td align="center" valign="middle" style="width: 172px;"> <span class="tiny"><span class="formula"><span class="array"><span class="arrayrow"> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r"> 0 </span> <span class="arraycell align-r"> 1 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r">  − 2 </span> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> 2 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r">  − 1 </span> <span class="arraycell align-r"> &nbsp;&nbsp;&nbsp;0 </span> <span class="arraycell align-r"> &nbsp;&nbsp;&nbsp;1 </span> </span> </span></span></span> </td>
						<td align="center" valign="middle" style="width: 172px;"> <span class="tiny"><span class="formula"><span class="array"><span class="arrayrow"> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> 0 </span> <span class="arraycell align-r">  − 1 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r"> 2 </span> <span class="arraycell align-r"> &nbsp;&nbsp;&nbsp; 1 </span> <span class="arraycell align-r">  − 2 </span> </span> <span class="arrayrow"> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> <span class="arraycell align-r">   </span> </span> <span class="arrayrow"> <span class="arraycell align-r"> 1 </span> <span class="arraycell align-r"> 0 </span> <span class="arraycell align-r">  − 1 </span> </span> </span></span></span> </td>
					</tr>
				</table>
				<img class="figure" src="images/ShadowsDemo.png" alt="figure images/ShadowsDemo.png" style="width: 860px; height: 185px;" /> 
				<div class="caption" style="text-align:center;">
					Figure 30 <b><span class="menuitem"><b><a class="Reference" href="146-29.html#sub:Shadows">Shadows<span class="menusep">▷</span>↑</a></b></span>:<i> </i><span class="menuitem"><b>North</b></span>, <span class="menuitem"><b>South</b></span>, <span class="menuitem"><b>East</b></span>, and <span class="menuitem"><b>West</b></span> kernels.</b> 
				</div>
			</div>
		</div>
	</div>
	<h2 class="Subsection">
		<a class="toc" name="toc-Subsection-29.8">29.8</a> <span class="menuitem">Binary<span class="menusep">▷</span></span><a class="Label" name="sub:Binary"> </a> 
	</h2>
	<div class="Standard">
		This submenu contains commands that create or process binary (black and white) images. They assume that objects are black and background is white unless <i>Black Background</i> is checked in the <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span> dialog box (<i>see</i> <a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a>). 
	</div>
	<div class="Standard">
		<div class="float">
			<a class="Label" name="Table-5"> </a>
			<div class="table" style="max-width: 100%;">
				<div class="tablecaption">
					Table 5 <b>Summary of morphological operators (<span class="sans">Process<span class="menusep">▷</span></span><a class="Reference" href="146-29.html#sub:Binary">Binary<span class="menusep">▷</span>↑</a> submenu).</b> 
				</div>
				<table class="blank">
					<tr>
						<td align="center" valign="top" style="width: 109px;"> <span class="footnotesize">Original</span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="footnotesize"><a class="Reference" href="146-29.html#sub:Make-Binary">Make Binary↓</a></span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="footnotesize"><a class="Reference" href="146-29.html#sub:Erode">Erode↓</a></span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="footnotesize"><a class="Reference" href="146-29.html#sub:Dilate">Dilate↓</a></span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="footnotesize"><a class="Reference" href="146-29.html#sub:Open">Open↓</a></span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="footnotesize"><a class="Reference" href="146-29.html#sub:Close--">Close--↓</a></span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="footnotesize"><a class="Reference" href="146-29.html#sub:Outline">Outline↓</a></span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="footnotesize"><a class="Reference" href="146-29.html#sub:Skeletonize"><span class="menuitem">Skeletonize</span>↓</a></span> </td>
					</tr>
					<tr>
						<td align="center" valign="top" style="width: 109px;" colspan="8"> <span class="scriptsize"><img class="figure" src="images/BinaryDemo.png" alt="figure images/BinaryDemo.png" style="width: 869px; height: 35px;" /> </span> </td>
					</tr>
					<tr>
						<td align="center" valign="top" style="width: 109px;" colspan="2"> <span class="scriptsize">Adjust<span class="menusep">▷</span><a class="Reference" href="146-28.html#sub:Threshold...[T]"><span class="menuitem">Threshold… [T]</span>↑</a></span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="scriptsize"><a class="Reference" href="146-29.html#sub:Minimum..."><span class="menuitem">Minimum…</span>↓</a> (grayscale)</span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="scriptsize"><a class="Reference" href="146-29.html#sub:Maximum..."><span class="menuitem">Maximum…</span>↓</a> (grayscale)</span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="scriptsize"><a class="Reference" href="146-29.html#sub:Erode">Erode↓</a> then <a class="Reference" href="146-29.html#sub:Dilate">Dilate↓</a></span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="scriptsize"><a class="Reference" href="146-29.html#sub:Dilate">Dilate↓</a> then <a class="Reference" href="146-29.html#sub:Erode">Erode↓</a></span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="scriptsize">1 pixel wide outline</span> </td>
						<td align="center" valign="top" style="width: 109px;"> <span class="scriptsize">1 pixel wide skeleton</span> </td>
					</tr>
				</table>
			</div>
		</div>
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.8.1">29.8.1</a> <span class="menuitem">Make Binary</span><a class="Label" name="sub:Make-Binary"> </a> 
	</h3>
	<div class="Standard">
		<div class="minipagefloat">
			<img class="embedded" src="images/MakeBinary.png" alt="figure images/MakeBinary.png" style="width: 233px; height: 136px;" /> 
		</div>
		<div class="Standard">
			Converts an image to black and white. If a threshold has been set using the <span class="menuitem">Image<span class="menusep">▷</span>Adjust<span class="menusep">▷</span><a class="Reference" href="146-28.html#sub:Threshold...[T]"><span class="menuitem">Threshold… [T]</span>↑</a></span> tool, the depicted dialog is displayed. The value of the <i>Black foreground, white background</i> checkbox reflects and sets the global <i>Black Background</i> value of <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span> 
		</div>
		<div class="medskip">
		</div>
	</div>
	<div class="Standard">
		If a threshold has not been set, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Make-Binary">Make Binary↑</a></span> will analyze the histogram of the current selection, or of the entire image if no selection is present, and set an automatic threshold level to create the binary image (<i>&lsquo;Auto-thresholding</i>&rsquo; is displayed in the Status bar, cf. <span class="menuitem"><a class="Reference" href="146-28.html#sub:Threshold...[T]"><span class="menuitem">Threshold… [T]</span>↑</a></span>). 
	</div>
	<div class="Standard">
		With stacks the <span class="menuitem"><a class="Reference" href="146-29.html#sub:Convert-to-Mask">Convert to Mask↓</a></span> dialog box is displayed. Note that for non-thresholded images and stacks <span class="menuitem"><a class="Reference" href="146-29.html#sub:Make-Binary">Make Binary↑</a></span> and <span class="menuitem"><a class="Reference" href="146-29.html#sub:Convert-to-Mask">Convert to Mask↓</a></span> behave similarly. 
	</div>
	<div class="See">
		<span class="menuitem">Edit<span class="menusep">▷</span>Selection<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Convert-to-Mask">Convert to Mask↓</a></span>, <a class="Reference" href="146-29.html#infobox:InvertedLutMask">21: Creating Binary Masks↓</a>, <a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a> 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.8.2">29.8.2</a> <span class="menuitem">Convert to Mask</span><a class="Label" name="sub:Convert-to-Mask"> </a> 
	</h3>
	<div class="Standard">
		<div class="minipagefloat">
			<img class="embedded" src="images/ConvertToMask.png" alt="figure images/ConvertToMask.png" style="width: 215px; height: 126px;" /> 
		</div>
		<div class="Standard">
			Converts an image to black and white. 
			<div class="medskip">
			</div>
			The mask will have an inverting LUT (white is 0 and black is 255) unless <i>Black Background</i> is checked in the <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span> dialog box. If a threshold has not been set, automatic threshold levels will be calculated (cf. <span class="menuitem"><a class="Reference" href="146-29.html#sub:Make-Binary">Make Binary↑</a></span>). Note that for non-thresholded images and stacks <span class="menuitem"><a class="Reference" href="146-29.html#sub:Make-Binary">Make Binary↑</a></span> and <span class="menuitem"><a class="Reference" href="146-29.html#sub:Convert-to-Mask">Convert to Mask↑</a></span> behave similarly. 
		</div>
	</div>
	<div class="Standard">
		With stacks, the depicted dialog is displayed. 
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Calculate Threshold for Each Image</i></span> If checked, threshold levels will be calculated for each individual slice, otherwise the calculated threshold of the currently displayed slice will be used for all slices 
	</div>
	<div class="Description">
		<span class="Description-entry"><i>Black</i> <i>Background</i></span> Defines whether the background is black and the foreground is white. Note that the value of this checkbox reflects and sets the global <i>Black Background</i> value of <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span> 
	</div>
	<div class="See">
		<span class="menuitem"><a class="Reference" href="146-29.html#sub:Make-Binary">Make Binary↑</a></span>, <span class="menuitem">Edit<span class="menusep">▷</span>Selection<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Convert-to-Mask">Convert to Mask↑</a></span>, <a class="Reference" href="146-29.html#infobox:InvertedLutMask">21: Creating Binary Masks↓</a>, 
	</div>
	<div class="Standard">
		<div class="float">
			<a class="Label" name="infobox:InvertedLutMask"> </a>
			<div class="infobox">
				<div class="infoboxcaption">
					21 Creating Binary Masks 
				</div>
				Four ImageJ commands can be used to create binary masks:
				<ol>
					<li> <span class="menuitem">Edit<span class="menusep">▷</span>Selection<span class="menusep">▷</span><a class="Reference" href="146-27.html#sub:Create-Mask">Create Mask↑</a></span> </li>
					<li> <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Make-Binary">Make Binary↑</a></span> </li>
					<li> <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Convert-to-Mask">Convert to Mask↑</a></span> </li>
					<li> <span class="menuitem">Image<span class="menusep">▷</span>Adjust<span class="menusep">▷</span><a class="Reference" href="146-28.html#sub:Threshold...[T]"><span class="menuitem">Threshold… [T]</span>↑</a></span> (<i>Apply</i>) </li>
				</ol>
				By default these commands will produce binary images with inverted LUTs, so that black is 255 and white is 0 (<i>see</i> <a class="Reference" href="146-28.html#sub:Invert-LUT">Invert LUT↑</a>). This behavior can be reversed by checking <i>Black Background</i> in <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span> before running the above commands (i.e., an inverting LUT will not be used: black will be 0 and white 255). This choice can be confirmed when running <span class="menuitem"><a class="Reference" href="146-29.html#sub:Make-Binary">Make Binary↑</a></span> and <span class="menuitem"><a class="Reference" href="146-29.html#sub:Convert-to-Mask">Convert to Mask↑</a></span> on thresholded images. It can also be imposed at startup (<i>see</i> <a class="Reference" href="146-13.html#sec:Settings-and-Preferences">Settings and Preferences↑</a>).
				<div class="See">
					<a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a> 
				</div>
			</div>
		</div>
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.8.3">29.8.3</a> <span class="menuitem">Erode</span><a class="Label" name="sub:Erode"> </a> 
	</h3>
	<div class="Standard">
		Removes pixels from the edges of objects in a binary image. Use <span class="menuitem">Filters<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Minimum..."><span class="menuitem">Minimum…</span>↓</a></span> to perform grayscale erosion on non-thresholded images. 
	</div>
	<div class="See">
		<span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span>, <a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a> 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.8.4">29.8.4</a> <span class="menuitem">Dilate</span><a class="Label" name="sub:Dilate"> </a> 
	</h3>
	<div class="Standard">
		Adds pixels to the edges of objects in a binary image. Use <span class="menuitem">Filters<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Maximum..."><span class="menuitem">Maximum…</span>↓</a></span> to perform grayscale dilation on non-thresholded images. 
	</div>
	<div class="See">
		<span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span>, <a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a> 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.8.5">29.8.5</a> <span class="menuitem">Open</span><a class="Label" name="sub:Open"> </a> 
	</h3>
	<div class="Standard">
		Performs an erosion operation, followed by dilation. This smoothes objects and removes isolated pixels. 
	</div>
	<div class="See">
		<span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span>, <a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a> 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.8.6">29.8.6</a> <span class="menuitem">Close--</span><a class="Label" name="sub:Close--"> </a> 
	</h3>
	<div class="Standard">
		Performs a dilation operation, followed by erosion. This smoothes objects and fills in small holes. The command has a tailing hyphen to differentiate it from <span class="menuitem">File<span class="menusep">▷</span><a class="Reference" href="146-26.html#sub:Close[w]">Close [w]↑</a></span> . 
	</div>
	<div class="See">
		<span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span>, <a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a> 
	</div>
	<div class="Standard">
		<div class="float">
			<a class="Label" name="Figure-31"> </a>
			<div class="figure" style="max-width: 100%;">
				<table class="blank">
					<tr>
						<td align="center" valign="middle" style="width: 144px;"> <span class="scriptsize">Original</span> </td>
						<td align="center" valign="middle" style="width: 143px;"> <span class="scriptsize"><a class="Reference" href="146-29.html#sub:Distance-Map">Distance Map↓</a></span> </td>
						<td align="center" valign="middle" style="width: 143px;"> <span class="scriptsize"><a class="Reference" href="146-29.html#sub:Ultimate-Points"><span class="menuitem">Ultimate Points</span>↓</a></span> </td>
						<td align="center" valign="middle" style="width: 143px;"> <span class="scriptsize"><a class="Reference" href="146-29.html#sub:Watershed">Watershed↓</a></span> </td>
						<td align="center" valign="middle" style="width: 143px;"> <span class="scriptsize"><a class="Reference" href="146-29.html#sub:Voronoi">Voronoi↓</a></span> </td>
						<td align="center" valign="middle" style="width: 144px;"> <span class="scriptsize">Original + <a class="Reference" href="146-29.html#sub:Voronoi">Voronoi↓</a> + <a class="Reference" href="146-29.html#sub:Ultimate-Points"><span class="menuitem">Ultimate Points</span>↓</a></span> </td>
					</tr>
				</table>
				<img class="figure" src="images/BinaryCommands.png" alt="figure images/BinaryCommands.png" style="width: 860px; height: 149px;" /> 
				<div class="caption" style="text-align:center;">
					Figure 31 <b><span class="menuitem"><b>Process<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Binary">Binary<span class="menusep">▷</span>↑</a></b></span> commands.</b> 
				</div>
			</div>
		</div>
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.8.7">29.8.7</a> <span class="menuitem">Outline</span><a class="Label" name="sub:Outline"> </a> 
	</h3>
	<div class="Standard">
		Generates a one pixel wide outline of foreground objects in a binary image. The line is drawn inside the object, i.e., on previous foreground pixels. 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.8.8">29.8.8</a> <span class="menuitem">Fill Holes</span><a class="Label" name="sub:Fill-Holes"> </a> 
	</h3>
	<div class="Standard">
		This command fills holes (4--connected background elements) in objects by filling the background <span class="bibcites">[<a class="bibliocite" name="cite-34" href="146-References.html#biblio-34">34</a>]</span>. 
	</div>
	<h3 class="Subsubsection">
		<a class="toc" name="toc-Subsubsection-29.8.9">29.8.9</a> <span class="menuitem">Skeletonize</span><a class="Label" name="sub:Skeletonize"> </a> 
	</h3>
	<div class="Standard">
		Repeatably remove pixels from the edges of objects in a binary image until they are reduced to single-pixel-wide shapes (<a class="URL" href="http://en.wikipedia.org/wiki/Topological_skeleton">topological skeletons</a>). As explained in <a class="Reference" href="146-29.html#infobox:Skeletonize-vs-Skeletonize3D">22: Skeletonize vs Skeletonize 3D↓</a>, there are several skeletonization algorithms. ImageJ implements a thinning algorithm from Zhang and Suen. <a class="URL" href="http://dx.doi.org/10.1145/357994.358023">A fast parallel algorithm for thinning digital patterns</a>. <i>CACM</i> 27(3):236--239, 1984, in which a <a class="URL" href="http://imagej.nih.gov/ij/images/skeletonize-table.gif">lookup table</a> indexes all the 256 possible 3<span class="formula"> × </span>3 neighborhood configurations for each foreground pixel. The algorithm calculates the index number for each object pixel, and uses the lookup table to decide if the pixel is eliminable. This process is repeated until no pixel can be eliminated. 
	</div>
	<div class="Standard">
		When debugging is enabled in <span class="menuitem">Edit<span class="menusep">▷</span>Options<span class="menusep">▷</span><a class="Reference" href="146-27.html#sub:Misc...">Misc…↑</a></span>, <span class="menuitem">Skeletonize</span> creates an animation documenting the iterations of the thinning algorithm. 
	</div>
	<div class="See">
		<a class="URL" href="http://fiji.sc/wiki/index.php/AnalyzeSkeleton">AnalyzeSkeleton</a> plugin, <a class="URL" href="http://imagej.nih.gov/ij/source/ij/process/BinaryProcessor.java">BinaryProcessor source code</a> 
	</div>
	<div class="Standard">
		<div class="float">
			<a class="Label" name="infobox:Skeletonize-vs-Skeletonize3D"> </a>
			<div class="infobox">
				<div class="infoboxcaption">
					22 <span class="menuitem">Skeletonize</span> vs <span class="menuitem">Skeletonize 3D</span> 
				</div>
				<a class="URL" href="http://fiji.sc/wiki/index.php/Skeletonize3D">Skeletonize3D</a> is a ImageJ plugin written by Ignacio Arganda-Carreras <span class="bibcites">[<a class="bibliocite" name="cite-35" href="146-References.html#biblio-35">35</a>]</span> that offers several advantages over <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Skeletonize"><span class="menuitem">Skeletonize</span>↑</a></span>, the legacy skeletonization algorithm of ImageJ:
				<ul>
					<li> <span class="menuitem"><a class="Reference" href="146-29.html#sub:Skeletonize"><span class="menuitem">Skeletonize</span>↑</a></span> works only with binary 2D images. <a class="URL" href="http://fiji.sc/wiki/index.php/Skeletonize3D">Skeletonize3D</a> works with 8-bit 2D images and stacks, expecting the image to be binary. If not, <a class="URL" href="http://fiji.sc/wiki/index.php/Skeletonize3D">Skeletonize3D</a> considers all pixel values above 0 to be white (255). </li>
					<li> While <span class="menuitem"><a class="Reference" href="146-29.html#sub:Skeletonize"><span class="menuitem">Skeletonize</span>↑</a></span> relies on <i>Black background</i> value in <span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span> (<i>see</i> <a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a>), the output of <a class="URL" href="http://fiji.sc/wiki/index.php/Skeletonize3D">Skeletonize3D</a> always has a value of 255 at the skeleton and 0 at background pixels, independently of the <i>Black background</i> option. </li>
				</ul>
				In <a class="Reference" href="146-2.html#sub:Fiji-intro">Fiji↑</a>, <span class="menuitem">Skeletonize 3D</span> is already pre-installed as <span class="menuitem">Plugins<span class="menusep">▷</span>Skeleton<span class="menusep">▷</span>Skeletonize (2D/3D)</span>. In ImageJ, it can be downloaded and installed from the <a class="URL" href="http://fiji.sc/wiki/index.php/Skeletonize3D">Skeletonize3D homepage</a>.
				<div class="bigskip">
				</div>
			<div class="center">
				<span class="small"><img class="embedded" src="images/Skeletonize3D.png" alt="figure images/Skeletonize3D.png" style="width: 266px; height: 123px;" /> </span> 
			</div>
		<div class="Standard">
			<span class="small">Maximum projections (<span class="menuitem"><span class="small">Image<span class="menusep">▷</span>Stacks<span class="menusep">▷</span><a class="Reference" href="146-28.html#sub:Z-Project..."><span class="menuitem">Z Project…</span>↑</a></span></span>) of skeletons produced by <span class="menuitem"><span class="small"><a class="Reference" href="146-29.html#sub:Skeletonize"><span class="menuitem">Skeletonize</span>↑</a></span></span> (middle) and </span><span class="default"><a class="URL" href="http://fiji.sc/wiki/index.php/Skeletonize3D">Skeletonize3D</a></span><span class="small"> (right). The left image is the maximum projection of the original stack, <span class="menuitem"><span class="small">File<span class="menusep">▷</span><a class="Reference" href="146-26.html#sub:OpenSamples">Open Samples<span class="menusep">▷</span>↑</a><a class="URL" href="http://imagej.nih.gov/ij/images/bat-cochlea-volume.zip">Bat Cochlea Volume (19K)</a></span></span>. Topographic skeletons can be analyzed using the </span><span class="default"><a class="URL" href="http://fiji.sc/wiki/index.php/AnalyzeSkeleton">AnalyzeSkeleton</a> plugin.</span> 
		</div>		
	</div>
</div>
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.8.10">29.8.10</a> <span class="menuitem">Distance Map</span><a class="Label" name="sub:Distance-Map"> </a> 
</h3>
<div class="Standard">
	Generates a Euclidian distance map (EDM) from a binary image <span class="bibcites">[<a class="bibliocite" name="cite-88" href="146-References.html#biblio-88"><span class="bib-index">38</span></a>]</span>. Each foreground pixel in the binary image is replaced with a gray value equal to that pixel’s distance from the nearest background pixel (for background pixels the EDM is 0). The <span class="menuitem"><a class="Reference" href="146-29.html#sub:Ultimate-Points"><span class="menuitem">Ultimate Points</span>↓</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Watershed">Watershed↓</a></span> and <span class="menuitem"><a class="Reference" href="146-29.html#sub:Voronoi">Voronoi↓</a></span> operations are based on the EDM algorithm. 
</div>
<div class="Standard">
	The output type (<i>Overwrite</i>, <i>8-bit</i>, <i>16-bit</i> or <i>32-bit</i>) of this command can be set in the <span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span> dialog box. Note that when selecting &lsquo;<i>Overwrite</i>&rsquo; or &lsquo;<i>8-bit output</i>&rsquo;, distances larger than 255 are labelled as 255. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.8.11">29.8.11</a> <span class="menuitem">Ultimate Points</span><a class="Label" name="sub:Ultimate-Points"> </a> 
</h3>
<div class="Standard">
	Generates the ultimate eroded points (UEPs<a class="NomenclatureEntry" name="noment-ueps" href="146-Nomenclature.html#nom-ueps">[?]</a>) of the Euclidian distance map (EDM, <i>see</i> <span class="menuitem"><a class="Reference" href="146-29.html#sub:Distance-Map">Distance Map↑</a></span>) from a binary image. Ultimate Eroded Points are maxima of the EDM. In the output, the points are assigned the EDM value, which is equal to the radius of the largest circle that fits into the binary particle, with the UEP as the center. The output type (<i>Overwrite</i>, <i>8-bit</i>, <i>16-bit</i> or <i>32-bit</i>) of this command can be set in the <span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span> dialog box. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.8.12">29.8.12</a> <span class="menuitem">Watershed</span><a class="Label" name="sub:Watershed"> </a> 
</h3>
<div class="Standard">
	Watershed segmentation is a way of automatically separating or cutting apart particles that touch. It first calculates the Euclidian distance map (EDM) and finds the ultimate eroded points (UEPs). It then dilates each of the UEPs (the peaks or local maxima of the EDM) as far as possible — either until the edge of the particle is reached, or the edge touches a region of another (growing) UEP. Watershed segmentation works best for smooth convex objects that don’t overlap too much. 
</div>
<div class="Standard">
	Enable debugging in <span class="menuitem">Edit<span class="menusep">▷</span>Options<span class="menusep">▷</span><a class="Reference" href="146-27.html#sub:Misc...">Misc…↑</a></span> and the <span class="menuitem">Watershed</span> command will create an animation that shows how the watershed algorithm works (cf. <a class="URL" href="http://imagej.nih.gov/ij/images/watershed-animation.gif">online example</a>). 
</div>
<div class="See">
	<span class="menuitem"><a class="Reference" href="146-29.html#sub:Find-Maxima"><span class="menuitem">Find Maxima…</span>↑</a></span> (<span class="menuitem">Segmented Particles</span> output) for watershed segmentation of grayscale images. 
</div>
<div class="Standard">
	<div class="float">
		<a class="Label" name="Figure-32"> </a>
		<div class="figure" style="max-width: 100%;">
			<table class="blank">
				<tr>
					<td align="center" valign="middle" style="width: 180px;"> 
					<div class="center">
						<span class="scriptsize">Original</span> 
					</div>
					</td>
					<td align="center" valign="middle" style="width: 440px;" colspan="3"> 
					<div class="center">
						<span class="scriptsize">Segmentation Movie </span> 
					</div>
					</td>
					<td align="center" valign="middle" style="width: 180px;"> 
					<div class="center">
						<span class="scriptsize"><a class="Reference" href="146-29.html#sub:Watershed">Watershed↑</a> result</span> 
					</div>
					</td>
				</tr>
			</table>
			<img class="figure" src="images/WatershedMontage.png" alt="figure images/WatershedMontage.png" style="width: 800px; height: 174px;" /> 
			<div class="caption" style="text-align: center;">
				Figure 32 <span class="sans"><span class="menuitem"><span class="sans">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Watershed">Watershed↑</a></span></span></span><b> running in Debug mode.</b> 
			</div>
		</div>
	</div>
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.8.13">29.8.13</a> <span class="menuitem">Voronoi</span><a class="Label" name="sub:Voronoi"> </a> 
</h3>
<div class="Standard">
	Splits the image by lines of points having equal distance to the borders of the two nearest particles. Thus, the Voronoi cell of each particle includes all points that are nearer to this particle than any other particle. When particles are single points, this process is a Voronoi tessellation (also known as Dirichlet tessellation). 
</div>
<div class="Standard">
	The output type (<i>Overwrite</i>, <i>8-bit</i>, <i>16-bit</i> or <i>32-bit</i>) of this command can be set in the <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↓</a></span> dialog box. In the output, the value inside the Voronoi cells is zero; the pixel values of the dividing lines between the cells are equal to the distance between the two nearest particles. This is similar to a medial axis transform of the background, but there are no lines in inner holes of particles. 
</div>
<div class="See">
	<span class="menuitem"><a class="Reference" href="146-29.html#sub:Find-Maxima"><span class="menuitem">Find Maxima…</span>↑</a></span> (<span class="menuitem">Segmented Particles</span> output), <a class="URL" href="http://fiji.sc/wiki/index.php/Delaunay_Voronoi">Delaunay_Voronoi plugin</a> 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.8.14">29.8.14</a> <span class="menuitem">Options…</span><a class="Label" name="sub:BinaryOptions..."> </a> 
</h3>
	<div class="minipagefloat">
		<img class="embedded" src="images/BinaryOptions.png" alt="figure images/BinaryOptions.png" style="width: 238px; height: 261px;" /> 
	</div>
<div class="Standard">
	Specifies several settings used by <span class="menuitem"><a class="Reference" href="146-29.html#sub:Binary">Binary<span class="menusep">▷</span>↑</a></span> commands. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Iterations</i></span> Specifies the number of times erosion, dilation, opening, and closing are performed. Iterations can be aborted by pressing <span class="Keystroke">Esc</span>. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Count</i></span> Specifies the number of adjacent background pixels necessary before a pixel is removed from the edge of an object during erosion and the number of adjacent foreground pixels necessary before a pixel is added to the edge of an object during dilation. 
</div>
<div class="Standard">
	<div class="Standard">
		<div class="Description">
			<span class="Description-entry"><i>Black background</i></span> If checked, binary images will be created without using an inverted LUT (cf. <a class="Reference" href="146-29.html#infobox:InvertedLutMask">21: Creating Binary Masks↑</a>) and commands in the <span class="menuitem">Process<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Binary">Binary<span class="menusep">▷</span>↑</a></span> submenu will assume that images contain white objects on a black background (<i>see</i> <a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a>). Macros can set this option using <span class="code">setOption("BlackBackground", true);</span> (<i>see</i> <a class="Reference" href="146-29.html#infobox:blackBackground">23: Interpreting Binary Images↓</a> and <a class="Reference" href="146-13.html#sec:Settings-and-Preferences">Settings and Preferences↑</a>). 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>Pad</i> <i>edges</i> <i>when</i> <i>eroding</i></span> If checked, <span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Erode">Erode↑</a></span> does not erode from the edges of the image. This setting also affects <span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Close--">Close--↑</a></span>, which erodes from the edges unless this checkbox is selected. 
		</div>
	</div>
</div>
<div class="Description">
	<span class="Description-entry"><i>EDM output</i></span> Determines the output type for the <span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Distance-Map">Distance Map↑</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Ultimate-Points"><span class="menuitem">Ultimate Points</span>↑</a></span> and <span class="menuitem"><a class="Reference" href="146-29.html#sub:Voronoi">Voronoi↑</a></span> commands. Set it to <i>&lsquo;Overwrite</i>&rsquo; for 8-bit output that overwrites the input image; &lsquo;<i>8-bit</i>&rsquo;, &lsquo;<i>16-bit</i>&rsquo; or <i>&lsquo;32-bit</i>&rsquo; for separate output images. 32-bit output has floating point (subpixel) distance resolution. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Do</i></span> This drop-down menu allows one to test the chosen settings by previewing each binary operation (<span class="menuitem"><a class="Reference" href="146-29.html#sub:Erode">Erode↑</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Dilate">Dilate↑</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Open">Open↑</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Close--">Close--↑</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Outline">Outline↑</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Fill-Holes">Fill Holes↑</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Skeletonize"><span class="menuitem">Skeletonize</span>↑</a></span>) on the active image. This option is only available when the active image is binary. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Help</i></span> Opens <a class="URL" href="http://imagej.nih.gov/ij/docs/menus/process.html#options">http://imagej.nih.gov/ij/docs/menus/process.html#options</a>. 
</div>
<div class="Standard">
	<div class="float">
		<a class="Label" name="infobox:blackBackground"> </a>
		<div class="infobox">
		<div class="infoboxcaption">
			23 Interpreting Binary Images 
		</div>
	<div class="minipagefloat">
	<table class="blank">
		<tr>
			<td align="center" valign="top"> <span class="scriptsize">0: Black (Background), 255: White</span> </td>
		</tr>
		<tr>
			<td align="center" valign="top"> <span class="small"><img class="embedded" src="images/BlackBackgroundAffect1.png" alt="figure images/BlackBackgroundAffect1.png" style="width: 185px; height: 120px;" /> </span> </td>
		</tr>
		<tr>
			<td align="center" valign="top"> <span class="scriptsize">0: White (Background), 255: Black</span> </td>
		</tr>
		<tr>
			<td align="center" valign="top"> <span class="small"><img class="embedded" src="images/BlackBackgroundAffect2.png" alt="figure images/BlackBackgroundAffect2.png" style="width: 185px; height: 120px;" /> </span> </td>
		</tr>
	</table>
</div>
		Binary images are thresholded to only two values, typically <span class="formula">0</span> and <span class="formula">1</span>, but often — as with ImageJ — <span class="formula">0</span> and <span class="formula">255</span>, that represent black and white on an 8-bit scale (<i>see</i> <a class="Reference" href="146-7.html#sec:Image-Types">Image Types and Formats↑</a>).
		<div class="medskip">
		</div>
		The interpretation of binary images is not universal. While some software packages will always perform binary operations on <span class="formula">255</span> values (or <span class="formula">1</span>, or any non-zero value), ImageJ takes into account the foreground and background colors of the binary image.
		<div class="medskip">
		</div>
<div class="Standard">
In ImageJ, the <i>Black background </i>option in<i> </i><span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↑</a></span> defines not only how new binary images will be created (<i>see</i> <a class="Reference" href="146-29.html#infobox:InvertedLutMask">21: Creating Binary Masks↑</a>) but also how previously created images are interpreted. This means object(s) will be inferred on a image-per-image basis. As such, inverting the LUT (<i>see</i> <a class="Reference" href="146-28.html#sub:Invert-LUT">Invert LUT↑</a>) of a binary image without updating the <i>Black background</i> option may lead to unexpected results, such as the aberrant thinning operation (<span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Skeletonize"><span class="menuitem">Skeletonize</span>↑</a></span>) depicted here. This issue can be avoided by imposing adequate preferences at startup, as described in <a class="Reference" href="146-13.html#sec:Settings-and-Preferences">Settings and Preferences↑</a>.
<div class="medskip">
</div>
You can use the <span class="menuitem">Process<span class="menusep">▷</span>Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:BinaryOptions..."><span class="menuitem">Options…</span>↑</a></span> dialog to assess the impact of the <i>Black background</i> option: Create a binary image, choose an operation from the <i>Do</i> drop-down menu, activate the preview feature and toggle the <i>Black background</i> checkbox.
<div class="See">
	<a class="Reference" href="146-13.html#sec:Settings-and-Preferences">Settings and Preferences↑</a>, <a class="Reference" href="146-29.html#infobox:InvertedLutMask">21: Creating Binary Masks↑</a> 
</div>
</div>
</div>
</div>
</div>
<h2 class="Subsection">
	<a class="toc" name="toc-Subsection-29.9">29.9</a> <span class="menuitem">Math<span class="menusep">▷</span></span><a class="Label" name="sub:Math"> </a> 
</h2>
<div class="Standard">
	The commands in this submenu add (subtract, multiply, etc.) a constant to each pixel in the active image or selection. A &lsquo;<i>Preview</i>&rsquo; option is available for most operations.
	<div class="medskip">
	</div>
</div>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/ProcessStack.png" alt="figure images/ProcessStack.png" style="width: 205px; height: 92px;" /> 
	</div>
	<div class="Standard">
		With stacks, the dialog depicted on the left is displayed. Choose &lsquo;<i>Yes&rsquo;</i> to process entire stack or &lsquo;<i>No</i>&rsquo; to process only the active slice. The dialog is not displayed if <i>Hide</i> <i>"Process</i> <i>Stack?"</i> <i>dialog </i>is checked in <span class="menuitem">Edit<span class="menusep">▷</span>Options<span class="menusep">▷</span><a class="Reference" href="146-27.html#sub:Misc...">Misc…↑</a></span> 
	</div>
</div>
<div class="See">
	<span class="menuitem"><a class="Reference" href="146-27.html#sub:Memory-&-Threads...">Memory &amp; Threads…↑</a></span> 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.1">29.9.1</a> <span class="menuitem">Add…</span> 
</h3>
<div class="Standard">
	Adds a constant to the image or selection. With 8-bit images, results greater than 255 are set to 255. With 16-bit signed images, results greater than 65,535 are set to 65,535. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.2">29.9.2</a> <span class="menuitem">Subtract…</span> 
</h3>
<div class="Standard">
	Subtracts a constant from the image or selection. With 8-bit and 16-bit images, results less than 0 are set to 0. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.3">29.9.3</a> <span class="menuitem">Multiply…</span> 
</h3>
<div class="Standard">
	Multiplies the image or selection by the specified real constant. With 8-bit images, results greater than 255 are set to 255. With 16-bit signed images, results greater than 65, 535 are set to 65, 535. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.4">29.9.4</a> <span class="menuitem">Divide…</span> 
</h3>
<div class="Standard">
	Divides the image or selection by the specified real constant. Except for 32-bit (float) images, attempts to divide by zero are ignored. With 32-bit images, dividing by zero results in <i>Infinity</i>, -<i>Infinity</i> or <i>NaN</i> (0/0) pixels when the source pixels are positive, negative or zero. The divide-by-zero value can be redefined using <span class="menuitem">Edit<span class="menusep">▷</span>Options<span class="menusep">▷</span><a class="Reference" href="146-27.html#sub:Misc...">Misc…↑</a></span>. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.5">29.9.5</a> <span class="menuitem">AND…</span> 
</h3>
<div class="Standard">
	Does a bitwise AND of the image and the specified binary constant. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.6">29.9.6</a> <span class="menuitem">OR…</span> 
</h3>
<div class="Standard">
	Does a bitwise OR of the image and the specified binary constant. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.7">29.9.7</a> <span class="menuitem">XOR…</span> 
</h3>
<div class="Standard">
	Does a bitwise XOR of the image and the specified binary constant. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.8">29.9.8</a> <span class="menuitem">Min…</span> 
</h3>
<div class="Standard">
	Pixels in the image with a value less than the specified constant are replaced by the constant. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.9">29.9.9</a> <span class="menuitem">Max…</span><a class="Label" name="sub:Max..."> </a> 
</h3>
<div class="Standard">
	Pixels in the image with a value greater than the specified constant are replaced by the constant. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.10">29.9.10</a> <span class="menuitem">Gamma…</span><a class="Label" name="sub:Gamma..."> </a> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/Gamma.png" alt="figure images/Gamma.png" style="width: 193px; height: 99px;" /> 
	</div>
	<div class="Standard">
		Applies the function <span class="formula"><i>f</i>(<i>p</i>) = (<span class="fraction"><sup class="numerator"><i>p</i></sup>⁄<sub class="denominator">255</sub></span>)<sup><i>γ</i></sup> × 255</span> to each pixel (<span class="formula"><i>p</i></span>) in the image or selection, where <span class="formula">0.1 ≤ <i>γ</i> ≤ 5.0</span>. For RGB images, this function is applied to all three color channels. For 16-bit images, the image min and max are used for scaling instead of 255. 
		<div class="See">
			<a class="URL" href="http://imagej.nih.gov/ij/macros/tools/GammaCorrectionTool.txt">GammaCorrectionTool</a> macro 
		</div>
	</div>
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.11">29.9.11</a> <span class="menuitem">Set…</span><a class="Label" name="sub:Set..."> </a> 
</h3>
<div class="Standard">
	Fills the image or selection with the specified value. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.12">29.9.12</a> <span class="menuitem">Log</span><a class="Label" name="sub:Log"> </a> 
</h3>
<div class="Standard">
	For 8-bit images, applies the function <span class="formula"><i>f</i>(<i>p</i>) = ln(<i>p</i>) × 255 ⁄ ln(255)</span> to each pixel (<span class="formula"><i>p</i></span>) in the image or selection. For RGB images, this function is applied to all three color channels. For 16-bit images, the image min and max are used for scaling instead of 255. For float images, no scaling is done. To calculate <span class="formula">log<sub>10</sub></span> of the image, multiply the result of this operation by 0.4343 (<span class="formula">1 ⁄ ln(10)</span>). 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.13">29.9.13</a> <span class="menuitem">Exp</span><a class="Label" name="sub:Exp"> </a> 
</h3>
<div class="Standard">
	Performs an exponential transform on the active image or selection. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.14">29.9.14</a> <span class="menuitem">Square</span><a class="Label" name="sub:Square"> </a> 
</h3>
<div class="Standard">
	Performs a square transform on the active image or selection. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.15">29.9.15</a> <span class="menuitem">Square Root</span><a class="Label" name="sub:Square-Root"> </a> 
</h3>
<div class="Standard">
	Performs a square root transform on the active image or selection. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.16">29.9.16</a> <span class="menuitem">Reciprocal</span><a class="Label" name="sub:Reciprocal"> </a> 
</h3>
<div class="Standard">
	Generates the reciprocal (multiplicative inverse) of the active image or selection, transforming each pixel (<span class="formula"><i>p</i></span>) into <span class="formula"><span class="fraction"><sup class="numerator">1</sup>⁄<sub class="denominator"><i>p</i></sub></span></span>. Requires 32-bit float images (<i>see</i> <a class="Reference" href="146-7.html#sec:Image-Types">Image Types and Formats↑</a>). 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.17">29.9.17</a> <span class="menuitem">NaN Background</span><a class="Label" name="sub:NaN-Background"> </a> 
</h3>
<div class="Standard">
	Sets non-thresholded pixels in 32-bit float images to the <i>NaN</i> (Not a Number) value. For float images, the <i>Apply</i> option in <span class="menuitem">Image<span class="menusep">▷</span>Adjust<span class="menusep">▷</span><a class="Reference" href="146-28.html#sub:Threshold...[T]"><span class="menuitem">Threshold… [T]</span>↑</a></span> runs this command. 
</div>
<div class="Standard">
	Pixels with a value of Float.NaN (0f/0f), Float.POSITIVE_INFINITY (1f/0f) or Float. NEGATIVE_INFINITY (-1f/0f) are ignored when making measurements on 32-bit float images. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.18">29.9.18</a> <span class="menuitem">Abs</span><a class="Label" name="sub:Abs"> </a> 
</h3>
<div class="Standard">
	Generates the absolute value of the active image or selection. Works only with 32-bit float or signed 16-bit image images. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.9.19">29.9.19</a> <span class="menuitem">Macro…</span><a class="Label" name="sub:Macro..."> </a> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/MathMacro.png" alt="figure images/MathMacro.png" style="width: 321px; height: 132px;" /> 
	</div>
	<div class="Standard">
		This command performs image arithmetic using an expression specified by the user <span class="bibcites">[<a class="bibliocite" name="cite-32" href="146-References.html#biblio-32">32</a>]</span>. It can be used to create fully-synthetic images or to perform precise pixel manipulations on existing images. The <a class="URL" href="http://imagej.nih.gov/ij/macros/examples/MathMacroDemo.txt">MathMacroDemo</a> macro demonstrates the usage of this command. 
	</div>
</div>
<div class="See">
	<a class="URL" href="http://www.ulfdittmer.com/imagej/index.html#Expression">Expression</a> plugin 
</div>
<h2 class="Subsection">
	<a class="toc" name="toc-Subsection-29.10">29.10</a> <span class="menuitem">FFT<span class="menusep">▷</span></span><a class="Label" name="sub:FFT"> </a> 
</h2>
<div class="Standard">
	The commands in this submenu support frequency domain display, editing and processing. They are based on an implementation of the 2D Fast Hartley Transform (FHT<a class="NomenclatureEntry" name="noment-fht" href="146-Nomenclature.html#nom-fht">[?]</a>) contributed by Arlo Reeves, the author of the <a class="URL" href="http://imagej.nih.gov/ij/download/docs/ImageFFT/">ImageFFT</a>, spinoff of NIH Image<span class="FootOuter"><span class="SupFootMarker"> [I] </span><span class="HoverFoot"><span class="SupFootMarker"> [I] </span>Although outdated, the <a class="URL" href="http://imagej.nih.gov/ij/download/docs/ImageFFT/FFT-docs.pdf">ImageFFT documentation</a> summarizes important frequency domain methodologies.</span></span>. 3D FHT can be performed using Bob Dougherty’s <a class="URL" href="http://www.optinav.com/FHT3D.htm">3D Fast Hartley Transform</a> plugin. 
</div>
<div class="Standard">
	The frequency domain image is stored as 32-bit float FHT attached to the 8-bit image that displays the power spectrum. Commands in this submenu, such as Inverse FFT, operate on the 32-bit FHT, not on the 8-bit power spectrum. All other ImageJ commands only &lsquo;see&rsquo; the power spectrum. 
</div>
<div class="Standard">
	Two FFT dedicated tutorials are available on the ImageJ website: <a class="URL" href="http://imagej.nih.gov/ij/docs/examples/tem/">FFT Measurements</a> and <a class="URL" href="http://imagej.nih.gov/ij/docs/examples/FFT/">FFT Filtering</a>. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.10.1">29.10.1</a> <span class="menuitem">FFT</span> 
</h3>
<div class="Standard">
	Computes the Fourier transform<a class="NomenclatureEntry" name="noment-fft" href="146-Nomenclature.html#nom-fft">[?]</a> and displays the power spectrum. Polar coordinates of measured point selections are recorded by <span class="menuitem">Analyze<span class="menusep">▷</span><a class="Reference" href="146-30.html#sub:Measure...[m]"><span class="menuitem">Measure… [m]</span>↓</a></span>. 
</div>
<div class="Standard">
	If the mouse is over an active frequency domain (FFT) window, its location is displayed in polar coordinates. The angle is expressed in degrees, while the radius is expressed in pixels per cycle (p/c<a class="NomenclatureEntry" name="noment-p/c" href="146-Nomenclature.html#nom-p/c">[?]</a>). The radius is expressed in [units] per cycle (e.g. mm/c) if the spatial scale of the image was defined using <span class="menuitem">Image<span class="menusep">▷</span><a class="Reference" href="146-28.html#sub:Image>Properties...">Properties… [P]↑</a></span> or <span class="menuitem">Analyze<span class="menusep">▷</span><a class="Reference" href="146-30.html#sub:Set-Scale...">Set Scale…↓</a></span> 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.10.2">29.10.2</a> <span class="menuitem">Inverse FFT</span> 
</h3>
<div class="Standard">
	Computes the inverse Fourier transform. You can filter or mask spots on the transformed (frequency domain) image and do an inverse transform to produce an image which only contains the frequencies selected or which suppresses the frequencies selected. Use ImageJ’s selection tools and fill / clear commands to draw black or white areas that mask portions of the transformed image. Black areas (<span class="formula"><span class="mbox">pixel value</span> = 0</span>) cause the corresponding frequencies to be filtered (removed) and white areas (<span class="formula"><span class="mbox">pixel value</span> = 255</span>) cause the corresponding frequencies to be passed. It is not, however, possible to both filter and pass during the same inverse transform. 
</div>
<div class="Standard">
	Note that areas to be filtered in the frequency domain image must be zero filled and areas to be passed must be filled with 255. You can verify that this is the case by moving the cursor over a filled area and observing that the values displayed in the status bar are either 0 or 255. Thus, you should always confirm that masked areas are not some other gray value, by using the black &amp; white reset option in the <a class="Reference" href="146-28.html#fig:CPtool">Color Picker window↑</a> widgets when defining foreground (<span class="menuitem">Edit<span class="menusep">▷</span><a class="Reference" href="146-27.html#sub:Fill-[f]">Fill [f]↑</a></span>) and background (<span class="menuitem">Edit<span class="menusep">▷</span><a class="Reference" href="146-27.html#sub:Clear">Clear↑</a></span>) colors. 
</div>
<div class="Standard">
	<div class="float">
		<a class="Label" name="Figure-33"> </a>
		<div class="figure" style="max-width: 100%;">
			<table class="blank">
				<tr>
					<td align="center" valign="middle" style="width: 142px;"> <span class="footnotesize">Original</span> </td>
					<td align="center" valign="middle" style="width: 142px;"> <span class="footnotesize">Power spectrum with mask that filters low frequencies</span> </td>
					<td align="center" valign="middle" style="width: 142px;"> <span class="footnotesize">Result of inverse transform</span> </td>
					<td align="center" valign="middle" style="width: 142px;"> <span class="footnotesize">Power spectrum with mask that passes low frequencies</span> </td>
					<td align="center" valign="middle" style="width: 143px;"> <span class="footnotesize">Result of inverse transform</span> </td>
				</tr>
			</table>
			<img class="figure" src="images/FFTlena.png" alt="figure images/FFTlena.png" style="width: 711px; height: 100px;" /> 
			<div class="caption" style="text-align:center;">
				Figure 33 <b>FFT: Example of low frequencies filtering.</b> 
			</div>
		</div>
	</div>
</div>
<div class="Standard">
	With off-center selections, the same spatial frequency appears twice in the power spectrum, at points opposite from the center. It is sufficient to fill / clear only one of these. 
</div>
<div class="Standard">
	<div class="float">
		<a class="Label" name="Figure-34"> </a>
		<div class="figure" style="max-width: 100%;">
			<table class="blank">
				<tr>
					<td align="center" valign="middle" style="width: 158px;"> <span class="footnotesize">Original</span> </td>
					<td align="center" valign="middle" style="width: 158px;"> <span class="footnotesize">Edited power spectrum</span> </td>
					<td align="center" valign="middle" style="width: 158px;"> <span class="footnotesize">Inverse transform</span> </td>
					<td align="center" valign="middle" style="width: 157px;"> <span class="footnotesize">Power spectrum after filtering</span> </td>
				</tr>
			</table>
			<img class="figure" src="images/FFTabe.png" alt="figure images/FFTabe.png" style="width: 630px; height: 102px;" /> 
			<div class="caption" style="text-align:center;">
				Figure 34 <b>FFT: Example of low frequencies filtering.</b> 
			</div>
		</div>
	</div>
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.10.3">29.10.3</a> <span class="menuitem">Redisplay Power Spectrum</span> 
</h3>
<div class="Standard">
	Recomputes the power spectrum from the frequency domain image (32-bit FHT). This command allows you to start over after mis-editing the 8-bit power spectrum image. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.10.4">29.10.4</a> <span class="menuitem">FFT Options…</span> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/FFToptions.png" alt="figure images/FFToptions.png" style="width: 186px; height: 159px;" /> 
	</div>
	<div class="Standard">
		Displays the FFT Options dialog box. The first group of checkboxes specifies which image(s) are created by the FFT command: 
		<div class="Description">
			<span class="Description-entry"><i>Display FFT Window</i></span> The standard output. It consists of an 8-bit image of the power spectrum and the actual data, which remain invisible for the user. The power spectrum image is displayed with logarithmic scaling, enhancing the visibility of components that are weakly visible. The actual data are used for the Inverse FFT command. 
		</div>
	</div>
</div>
<div class="Description">
	<span class="Description-entry"><i>Display Raw</i> <i>Power</i> <i>Spectrum</i></span> The power spectrum without logarithmic scaling. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Display Fast Hartley Transform</i></span> The internal format used by the command, which is based on a Hartley transform rather than Fourier transform. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Display Complex</i> <i>Fourier</i> <i>Transform</i></span> A stack with two slices for the real and imaginary parts of the FFT. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Do</i> <i>Forward</i> <i>Transform</i></span> If checked, the current image is transformed immediately when closing the FFT Options dialog. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.10.5">29.10.5</a> <span class="menuitem">Bandpass Filter…</span><a class="Label" name="sub:Bandpass-Filter..."> </a> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/FFTBandpassFilter.png" alt="figure images/FFTBandpassFilter.png" style="width: 297px; height: 206px;" /> 
	</div>
	<div class="Standard">
		Removes high spatial frequencies (blurring the image) and low spatial frequencies (similar to subtracting a blurred image). It can also suppress horizontal or vertical stripes that were created by scanning an image line by line <span class="bibcites">[<a class="bibliocite" name="cite-33" href="146-References.html#biblio-33">33</a>]</span>.
		<div class="medskip">
		</div>
		The Bandpass Filter uses a special algorithm to reduce edge artifacts (before the Fourier transform, the image is extended in size by attaching mirrored copies of image parts outside the original image, thus no jumps occur at the edges). 
	</div>
</div>
<div class="Description">
	<span class="Description-entry"><i>Filter Large Structures Down to</i></span> <i></i>Smooth variations of the image with typical sizes of bright or dark patches larger than this value are suppressed (background). 
</div>
<div class="Description">
	<span class="Description-entry"><i>Filter Large Structures Up to</i></span> <i></i>Determines the amount of smoothing. Objects in the image smaller than this size are strongly attenuated. Note that these values are both half the spatial frequencies of the actual cutoff. The cutoff is very soft, so the bandpass will noticeably attenuate even spatial frequencies in the center of the bandpass unless the difference of the two values is large (say, more than a factor of 5 or so). 
</div>
<div class="Description">
	<span class="Description-entry"><i>Suppress</i> <i>Stripes</i></span> Select whether to eliminate <i>Horizontal</i> or <i>Vertical</i> stripes. Removal of horizontal stripes is similar to subtracting an image that is only blurred in the horizontal direction from the original. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Tolerance of Direction</i></span> This is for <i>Suppress Stripes</i>; higher values remove shorter stripes and/or stripes that are running under an angle with respect to the horizontal (vertical) direction. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Autoscale</i> <i>After</i> <i>Filtering</i></span> If checked, puts the lowest intensity to 0 and the highest intensity to 255, preserving all intensities. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Saturate</i> <i>Image</i> <i>when</i> <i>Autoscaling</i></span> If checked, allows some intensities to go into saturation, and produces a better visual contrast. <i>Saturate</i> <i>Image</i> <i>when</i> <i>Autoscaling</i> only has an effect when <i>Autoscale</i> <i>After</i> <i>Filtering</i> is enabled. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Display Filter</i></span> If checked, shows the filter generated. Note that this disables Undo of the filter operation on the original image. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.10.6">29.10.6</a> <span class="menuitem">Custom Filter…</span> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/FFTcustomFilter.png" alt="figure images/FFTcustomFilter.png" style="width: 217px; height: 96px;" /> 
	</div>
	<div class="Standard">
		This command does Fourier space filtering of the active image using a user-supplied spatial domain (non-FFT) image as the filter. 
	</div>
</div>
<div class="Standard">
	This image will be converted to 8-bit. For pixels that have a value of 0, the corresponding spatial frequencies will be blocked. Pixel with values of 255 should be used for passing the respective spatial frequencies without attenuation. Note that the filter should be symmetric with respect to inversion of the center: Points that are opposite of the center point (defined as <span class="formula"><span class="mbox">x</span> = <i>width</i> ⁄ 2</span>, <span class="formula"><span class="mbox">y</span> = <i>height</i> ⁄ 2</span>) should have the same value. Otherwise, artifacts can occur. For some examples, see the <a class="URL" href="http://imagej.nih.gov/ij/macros/FFTCustomFilterDemo.txt">FFTCustomFilterDemo</a> and <a class="URL" href="http://imagej.nih.gov/ij/macros/FFTRemoveStreaks.txt">FFTRemoveStreaks</a> macros. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.10.7">29.10.7</a> <span class="menuitem">FD Math…</span> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/FFTMath.png" alt="figure images/FFTMath.png" style="width: 220px; height: 192px;" /> 
	</div>
	<div class="Standard">
		This command correlates, convolves or deconvolves two images. 
		<div class="medskip">
		</div>
		It does this by converting <i>Image1</i> and <i>Image2</i> to the frequency domain, performing conjugate multiplication or division, then converting the result back to the space domain. These three operations in the frequency domain are equivalent to correlation, convolution and deconvolution in the space domain.
		<div class="medskip">
		</div>
		Refer to the <a class="URL" href="http://imagej.nih.gov/ij/macros/DeconvolutionDemo.txt">DeconvolutionDemo</a> and <a class="URL" href="http://imagej.nih.gov/ij/macros/MotionBlurRemoval.txt">MotionBlurRemoval</a> macros for examples. 
	</div>
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.10.8">29.10.8</a> <span class="menuitem">Swap Quadrants</span><a class="Label" name="sub:Swap-Quadrants"> </a> 
</h3>
	<div class="minipagefloat">
		<table class="blank">
			<tr>
				<td align="center" valign="top" style="width: 83px;" colspan="2"> <span class="scriptsize">FFT</span> </td>
			</tr>
			<tr>
				<td align="center" valign="top" style="width: 83px;"> <span class="scriptsize">Original</span> </td>
				<td align="center" valign="top" style="width: 83px;"> <span class="scriptsize">Swapped</span> </td>
			</tr>
			<tr>
				<td align="center" valign="top" style="width: 83px;" colspan="2"> <img class="embedded" src="images/SwapQuadrantsFD.png" alt="figure images/SwapQuadrantsFD.png" style="width: 166px; height: 79px;" /> </td>
			</tr>
			<tr>
				<td align="center" valign="top" style="width: 83px;" colspan="2"> <span class="scriptsize">Non-FFT </span> </td>
			</tr>
			<tr>
				<td align="center" valign="top" style="width: 83px;"> <span class="scriptsize">Original</span> </td>
				<td align="center" valign="top" style="width: 83px;"> <span class="scriptsize">Swapped</span> </td>
			</tr>
			<tr>
				<td align="center" valign="top" style="width: 166px;" colspan="2"> <img class="embedded" src="images/SwapQuadrantsSD.png" alt="figure images/SwapQuadrantsSD.png" style="width: 166px; height: 79px;" /> </td>
			</tr>
		</table>
	</div>
<div class="Standard">
	This command transforms between the &lsquo;user friendly&rsquo; display of Fourier transforms with the lowest frequencies at the center and the &lsquo;native&rsquo; form with the lowest frequencies at the four corners. 
</div>
<div class="Standard">
	<div class="Standard">
		<span class="menuitem"><a class="Reference" href="146-29.html#sub:Swap-Quadrants">Swap Quadrants↑</a></span> swaps quadrants I with III and II with IV (counter-clockwise starting from &lsquo;Northeast&rsquo;) so that points near the center are moved towards the edge and vice versa. Another way to see this command is to imagine that the image is periodically repeated and the origin is shifted by <span class="formula"><i>width</i> ⁄ 2</span> in x and by <span class="formula"><i>height</i> ⁄ 2</span> in y direction.
		<div class="medskip">
		</div>
		For Fourier transforms, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Swap-Quadrants">Swap Quadrants↑</a></span> affects only the image displayed, not the actual FHT data. Therefore, editing an image with swapped quadrants for filtering or masking may lead to undesired results. 
	</div>
</div>
<h2 class="Subsection">
	<a class="toc" name="toc-Subsection-29.11">29.11</a> <span class="menuitem">Filters<span class="menusep">▷</span></span><a class="Label" name="sub:Filters"> </a> 
</h2>
<div class="Standard">
	This submenu contains miscellaneous filters <span class="bibcites">[<a class="bibliocite" name="cite-36" href="146-References.html#biblio-36">36</a>]</span> (including those installed by the <span class="menuitem">Plugins<span class="menusep">▷</span>Utilities<span class="menusep">▷</span><a class="Reference" href="146-31.html#sub:Install-Plugin...">Install Plugin…↓</a></span> command). 
</div>
<div class="Standard">
	More information on image filters can be obtained by looking up related keywords (<i>convolution, Gaussian, median, mean, erode, dilate, unsharp</i>, etc.) on the <a class="URL" href="http://homepages.inf.ed.ac.uk/rbf/HIPR2/">Hypermedia Image Processing Reference</a><i> </i><a class="URL" href="http://homepages.inf.ed.ac.uk/rbf/HIPR2/index.htm">index</a>. 
</div>
<div class="See">
	<span class="menuitem"><a class="Reference" href="146-27.html#sub:Memory-&-Threads...">Memory &amp; Threads…↑</a></span> 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.11.1">29.11.1</a> <span class="menuitem">Convolve…</span><a class="Label" name="sub:Convolve..."> </a> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/Convolve.png" alt="figure images/Convolve.png" style="width: 248px; height: 239px;" /> 
	</div>
	<div class="Standard">
		Does spatial convolution using a kernel entered into a text area. 
		<div class="medskip">
		</div>
		A kernel is a matrix whose center corresponds to the source pixel and the other elements correspond to neighboring pixels. The destination pixel is calculated by multiplying each source pixel by its corresponding kernel coefficient and adding the results. If needed, the input image is effectively extended by duplicating edge pixels outward. There is no arbitrary limit to the size of the kernel but it must be square and have an odd width. 
	</div>
</div>
<div class="Standard">
	<div class="medskip">
	</div>
</div>
<div class="Standard">
	Rows in the text area must all have the same number of coefficients, the rows must be terminated with a carriage return, and the coefficients must be separated by one or more spaces. Kernels can be pasted into the text area using <span class="Keystroke">Ctrl</span> <span class="Keystroke">V</span>. 
</div>
<div class="Standard">
	Checking <i>Normalize Kernel</i> causes each coefficient to be divided by the sum of the coefficients, preserving image brightness. 
</div>
<div class="Standard">
	The kernel shown is a <span class="formula">9 × 9</span> &ldquo;Mexican hat&rdquo;, which does both smoothing and edge detection in one operation. Note that kernels can be saved as a text file by clicking on the <i>&lsquo;Save</i>&rsquo; button, displayed as an image using <span class="menuitem">File<span class="menusep">▷</span>Import<span class="menusep">▷</span><a class="Reference" href="146-26.html#sub:Import>Text-Image"><span class="menuitem">Text Image…</span>↑</a></span>, scaled to a reasonable size using <span class="menuitem">Image<span class="menusep">▷</span>Adjust<span class="menusep">▷</span><a class="Reference" href="146-28.html#sub:Size..."><span class="menuitem">Size…</span>↑</a></span> and plotted using <span class="menuitem">Analyze<span class="menusep">▷</span><a class="Reference" href="146-30.html#sub:Surface-Plot...">Surface Plot…↓</a></span> 
</div>
<div class="See">
	<a class="URL" href="http://imagej.nih.gov/ij/macros/examples/ConvolutionDemo.txt">ConvolutionDemo</a> macro 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.11.2">29.11.2</a> <span class="menuitem">Gaussian Blur…</span><a class="Label" name="sub:Gaussian-Blur..."> </a> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/GaussianBlur.png" alt="figure images/GaussianBlur.png" style="width: 148px; height: 126px;" /> 
	</div>
	<div class="Standard">
		This filter uses convolution with a Gaussian function for smoothing <span class="bibcites">[<a class="bibliocite" name="cite-37" href="146-References.html#biblio-37">37</a>]</span>.
		<div class="medskip">
		</div>
		<i>Sigma</i> is the radius of decay to <span class="formula"><i>e</i><sup> − 0.5</sup></span> (<span class="formula">≈61%</span>), i.e., the standard deviation (<span class="formula"><i>σ</i></span>) of the Gaussian (this is the same as in Adobe<span class="tiny">®</span>Photoshop<span class="tiny">®</span>, but different from ImageJ versions till 1.38q, in which <i>radius</i> was 2.5<span class="formula"> × <i>σ</i></span> (cf. <a class="URL" href="http://imagej.nih.gov/ij/docs/source/ij/plugin/filter/GaussianBlur.java.html">GaussianBlur.java</a>). 
	</div>
</div>
<div class="Standard">
	Like all ImageJ convolution operations, it assumes that out-of-image pixels have a value equal to the nearest edge pixel. This gives higher weight to edge pixels than pixels inside the image, and higher weight to corner pixels than non-corner pixels at the edge. Thus, when smoothing with very high blur radius, the output will be dominated by the edge pixels and especially the corner pixels (in the extreme case, with a blur radius of e.g. <span class="formula">10<sup>20</sup></span>, the image will be replaced by the average of the four corner pixels). 
</div>
<div class="Standard">
	For increased speed, except for small blur radii, the lines (rows or columns of the image) are downscaled before convolution and upscaled to their original length thereafter. 
</div>
<div class="See">
	<span class="menuitem">Noise<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Add-Noise">Add Noise↑</a></span>, <a class="URL" href="http://imagej.nih.gov/ij/plugins/gaussian-blur.html">Accurate Gaussian Blur</a> plugin, <a class="URL" href="http://imagej.nih.gov/ij/macros/AnimatedGaussianBlur.txt">AnimatedGaussianBlur</a> macro 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.11.3">29.11.3</a> <span class="menuitem">Gaussian Blur 3D…</span><a class="Label" name="sub:Gaussian-Blur-3D..."> </a> 
</h3>
<div class="Standard">
	This command calculates a three dimensional (3D) gaussian lowpass filter using a 3-D Gaussian. It works with <a class="Reference" href="146-8.html#sub:Stacks-Intro">Stacks↑</a> and <a class="Reference" href="146-8.html#sub:Hyperstacks-Intro">Hyperstacks↑</a> but not single-slice <a class="Reference" href="146-9.html#sub:Color-Composites">Color Composite Images↑</a>. Refer to <a class="Reference" href="146-29.html#sub:Gaussian-Blur..."><span class="menuitem">Gaussian Blur…</span>↑</a> for more information on sigma values. 
</div>
<div class="See">
	<a class="URL" href="http://imagej.nih.gov/ij/source/ij/plugin/GaussianBlur3D.java">Gaussian Blur 3D source code</a> 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.11.4">29.11.4</a> <span class="menuitem">Median…</span><a class="Label" name="sub:Median..."> </a> 
</h3>
<div class="Standard">
	Reduces noise in the active image by replacing each pixel with the median of the neighboring pixel values. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.11.5">29.11.5</a> <span class="menuitem">Mean…</span><a class="Label" name="sub:Mean..."> </a> 
</h3>
<div class="Standard">
	Smooths the current image by replacing each pixel with the neighborhood mean. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.11.6">29.11.6</a> <span class="menuitem">Minimum…</span><a class="Label" name="sub:Minimum..."> </a> 
</h3>
<div class="Standard">
	This filter does grayscale erosion by replacing each pixel in the image with the smallest pixel value in that pixel’s neighborhood. 
</div>
<div class="See">
	<span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Erode">Erode↑</a></span> 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.11.7">29.11.7</a> <span class="menuitem">Maximum…</span><a class="Label" name="sub:Maximum..."> </a> 
</h3>
<div class="Standard">
	This filter does grayscale dilation by replacing each pixel in the image with the largest pixel value in that pixel’s neighborhood. 
</div>
<div class="See">
	<span class="menuitem">Binary<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Dilate">Dilate↑</a></span> 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.11.8">29.11.8</a> <span class="menuitem">Unsharp Mask…</span><a class="Label" name="sub:Unsharp-Mask..."> </a> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/UnsharpMask.png" alt="figure images/UnsharpMask.png" style="width: 224px; height: 129px;" /> 
	</div>
	<div class="Standard">
		Sharpens and enhances edges by subtracting a blurred version of the image (the unsharp mask) from the original.
		<div class="medskip">
		</div>
		Unsharp masking subtracts a blurred copy of the image and rescales the image to obtain the same contrast of large (low-frequency) structures as in the input image. This is equivalent to adding a high-pass filtered image and thus sharpens the image. 
	</div>
</div>
<div class="Description">
	<span class="Description-entry"><i>Radius</i></span> The standard deviation (<span class="formula"><i>σ</i></span> blur radius, cf. <span class="menuitem"><a class="Reference" href="146-29.html#sub:Gaussian-Blur..."><span class="menuitem">Gaussian Blur…</span>↑</a></span>) of the Gaussian blur that is subtracted. Increasing the Gaussian blur radius will increase contrast. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Mask Weight</i></span> Determines the strength of filtering, whereby <span class="formula"><i>MaskWeight</i> = 1</span> would be an infinite weight of the high-pass filtered image that is added. Increasing the <i>Mask Weight</i> value will provide additional edge enhancement. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.11.9">29.11.9</a> <span class="menuitem">Variance…</span><a class="Label" name="sub:Variance..."> </a> 
</h3>
<div class="Standard">
	Highlights edges in the image by replacing each pixel with the neighborhood variance. 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.11.10">29.11.10</a> <span class="menuitem">Show Circular Masks…</span><a class="Label" name="sub:Show-Circular-Masks..."> </a> 
</h3>
<div class="Standard">
	Generates a stack containing examples of the circular masks used by the <span class="menuitem"><a class="Reference" href="146-29.html#sub:Median..."><span class="menuitem">Median…</span>↑</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Mean..."><span class="menuitem">Mean…</span>↑</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Minimum..."><span class="menuitem">Minimum…</span>↑</a></span>, <span class="menuitem"><a class="Reference" href="146-29.html#sub:Maximum..."><span class="menuitem">Maximum…</span>↑</a></span>, and <span class="menuitem"><a class="Reference" href="146-29.html#sub:Variance..."><span class="menuitem">Variance…</span>↑</a></span> filters for various neighborhood sizes. 
</div>
<h2 class="Subsection">
	<a class="toc" name="toc-Subsection-29.12">29.12</a> <span class="menuitem">Batch<span class="menusep">▷</span></span><a class="Label" name="sub:Batch"> </a> 
</h2>
<div class="Standard">
	This submenu allows the execution of commands in a series of images without manual intervention. 
</div>
<div class="Standard">
	<span class="menuitem"><a class="Reference" href="146-29.html#sub:Batch">Batch<span class="menusep">▷</span>↑</a></span> commands are non-recursive, i.e., they are applied to all the images of the chosen <i>Input</i> folder but not its subfolders. Nevertheless a directory hierarchy can be transversed using ImageJ macro language (cf. <a class="URL" href="http://imagej.nih.gov/ij/macros/BatchProcessFolders.txt">BatchProcessFolders</a> macro). 
</div>
<div class="Standard">
	Three critical aspects to keep in mind when performing batch operations that modify processed images: 
</div>
<ul>
	<li> Files can be easily overwritten since the batch processor will silently override existing files with the same name. </li>
	<li> The destination <i>Output</i> folder should have adequate disk space to receive the created images. </li>
	<li> In the case of non-native formats, batch operations will be influenced by the behavior of the reader plugin or library (cf. <a class="Reference" href="146-7.html#sub:Non-native-Supported-Formats">Non--native Formats ↑</a>). </li>
</ul>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.12.1">29.12.1</a> <span class="menuitem">Measure…</span><a class="Label" name="sub:Measure..."> </a> 
</h3>
<div class="Standard">
	This command measures all the images in a user-specified folder, by running the <span class="menuitem">Analyze<span class="menusep">▷</span><a class="Reference" href="146-30.html#sub:Measure...[m]"><span class="menuitem">Measure… [m]</span>↓</a></span> command in all images of the chosen directory. 
</div>
<div class="Standard">
	Note that measurements are performed on non thresholded images. In the case of TIFF images saved with active selections measurements are performed on the ROI and not the whole image. 
</div>
<div class="See">
	<span class="menuitem">Analyze<span class="menusep">▷</span><a class="Reference" href="146-30.html#sub:Set-Measurements..."><span class="menuitem">Set Measurements…</span>↓</a></span>, <span class="menuitem">Batch<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:batch>Macro..."><span class="menuitem">Macro…</span>↓</a></span> 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.12.2">29.12.2</a> <span class="menuitem">Convert…</span><a class="Label" name="sub:Convert..."> </a> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/BatchConvert.png" alt="figure images/BatchConvert.png" style="width: 296px; height: 197px;" /> 
	</div>
	<div class="Standard">
		Batch converts and/or resizes multiple images from a specified folder.
		<div class="Description">
			<span class="Description-entry"><i>Input...</i></span> Selects the source folder containing the images to be processed. 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>Output...</i></span> Selects the destination folder where the processed images will be stored. 
		</div>
	</div>
</div>
<div class="Description">
	<span class="Description-entry"><i>Output Format</i></span> <i></i>Specifies the output format<i> </i>that can be set to<i> TIFF, 8-bit TIFF, JPEG, GIF, PNG, PGM, BMP, FITS, Text Image, ZIP </i>or<i> Raw </i>(cf. <a class="Reference" href="146-7.html#sec:Image-Types">Image Types and Formats↑</a> and <span class="menuitem">File<span class="menusep">▷</span><a class="Reference" href="146-26.html#sub:SaveAs">Save As<span class="menusep">▷</span>↑</a></span> submenu). 
</div>
<div class="Description">
	<span class="Description-entry"><i>Interpolation</i></span> The resampling method to be used in case <i>Scale Factor</i> is not 1.00 (<i>see</i> <span class="menuitem">Image<span class="menusep">▷</span><a class="Reference" href="146-28.html#sub:Size..."><span class="menuitem">Size…</span>↑</a></span> and <span class="menuitem">Image<span class="menusep">▷</span><a class="Reference" href="146-28.html#sub:Scale...[E]"><span class="menuitem">Scale… [E]</span>↑</a></span>). For better results, <i>Average when downsizing</i> is automatically selected when scaling down images. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Scale</i> <i>Factor</i></span> Specifies if images should be resized (<i>see</i> <span class="menuitem">Image<span class="menusep">▷</span><a class="Reference" href="146-28.html#sub:Scale...[E]"><span class="menuitem">Scale… [E]</span>↑</a></span>). 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.12.3">29.12.3</a> <span class="menuitem">Macro…</span><a class="Label" name="sub:batch>Macro..."> </a> 
</h3>
<div class="Standard">
	<div class="minipagefloat">
		<img class="embedded" src="images/BatchProcess.png" alt="figure images/BatchProcess.png" style="width: 336px; height: 341px;" /> 
	</div>
	<div class="Standard">
		Runs a macro over a specified folder. The last used macro is stored in the <span class="Filename">/ImageJ/macros/batchmacro.ijm</span> file and remembered across restarts..
		<div class="Description">
			<span class="Description-entry"><i>Input...</i></span> Selects the source folder containing the images to be processed. 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>Output...</i></span> Selects the destination folder where the processed images will be stored. Note that original files will not be saved if this field is left empty. 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>Output Format</i></span> <i></i>Specifies the output format<i> </i>that can be set to<i> TIFF, 8-bit TIFF, JPEG, GIF, PNG, PGM, BMP, FITS, Text Image, ZIP </i>or<i> Raw </i>(cf. <a class="Reference" href="146-7.html#sec:Image-Types">Image Types and Formats↑</a> and <span class="menuitem">File<span class="menusep">▷</span><a class="Reference" href="146-26.html#sub:SaveAs">Save As<span class="menusep">▷</span>↑</a></span> submenu). 
		</div>
	</div>
</div>
<div class="Description">
	<span class="Description-entry"><i>Add Macro Code</i></span> <i></i>This drop-down menu contains macro snippets that can be combined to create the processing macro. Other statements can be pasted from the macro recorder or ImageJ’s editor while the dialog box is opened <span class="bibcites">[<a class="bibliocite" name="cite-38" href="146-References.html#biblio-38">38</a>]</span>. Previously written macros can be imported using <i>Open</i>… When editing the macro beware of any statements that may interfere with the normal operation of the batch processor (such as<span class="code"> Close()</span> or <span class="code">Open()</span> calls). 
</div>
<div class="Description">
	<span class="Description-entry"><i>Test</i></span> Tests the macro on the first image of the <i>Input</i>… folder (the processed image will be displayed). 
</div>
<div class="Description">
	<span class="Description-entry"><i>Open…</i></span> <i></i>Imports previously written macros. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Save…</i></span> <i></i>Saves the assembled macro. 
</div>
<div class="See">
	<span class="menuitem">Plugins<span class="menusep">▷</span>Macros<span class="menusep">▷</span><a class="Reference" href="146-31.html#sub:Record...">Record…↓</a></span>, <span class="menuitem">Batch<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Virtual-Stack..."><span class="menuitem">Virtual Stack…</span>↓</a></span> 
</div>
<h3 class="Subsubsection">
	<a class="toc" name="toc-Subsubsection-29.12.4">29.12.4</a> <span class="menuitem">Virtual Stack…</span><a class="Label" name="sub:Virtual-Stack..."> </a> 
</h3>
<div class="Standard">
	This command, that shares the same interface of <span class="menuitem">Batch<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:batch>Macro..."><span class="menuitem">Macro…</span>↑</a></span> (cf. <span class="Filename"><a class="URL" href="http://imagej.nih.gov/ij/developer/source/ij/plugin/BatchProcesser.java.html">BatchProcesser.java</a></span>), allows virtual stack manipulations. E.g., Cropping a virtual stack can be performed by executing the following steps: 
</div>
<ol>
	<li> Open a virtual stack </li>
	<li> Run <span class="menuitem">Process<span class="menusep">▷</span>Batch<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Virtual-Stack..."><span class="menuitem">Virtual Stack…</span>↑</a></span> </li>
	<li> Select an <i>Output folder</i> and <i>Output</i> <i>format</i> </li>
	<li> Select &lsquo;<i>Crop</i>&rsquo; from the <i>Add Macro Code</i> drop-down menu </li>
	<li> Edit the macro code as needed and press the <i>Test</i> button to verify the macro </li>
	<li> Click <i>Process</i> to create the cropped virtual stack </li>
</ol>
<div class="Standard">
	Note that cropped images are not loaded into memory but are saved to disk as they are cropped (<i>see</i> <a class="Reference" href="146-8.html#sub:Virtual-Stacks">Virtual Stacks↑</a>). 
</div>
<h2 class="Subsection">
	<a class="toc" name="toc-Subsection-29.13">29.13</a> <span class="menuitem">Image Calculator…</span><a class="Label" name="sub:Image-Calculator..."> </a> 
</h2>
	<div class="minipagefloat">
		<img class="embedded" src="images/ImageCalculator.png" alt="figure images/ImageCalculator.png" style="width: 270px; height: 258px;" /> 
	</div>
<div class="Standard">
	Performs arithmetic and logical operations between two images selected from popup menus described in the <a class="Reference" href="146-29.html#tab:ImgCalculator">Image operations↓</a> table. <i>Image1</i> or both <i>Image1</i> and <i>Image2</i> can be stacks. If both are stacks, they must have the same number of slices. <i>Image1</i> and <i>Image2</i> do not have to be the same data type or the same size. 
</div>
<div class="Standard">
	With 32-bit (float) images, pixels resulting from division by zero are set to <i>Infinity</i>, or to <i>NaN</i> (Not a Number) if a zero pixel is divided by zero. The divide-by-zero value can be redefined in <span class="menuitem">Edit<span class="menusep">▷</span>Options<span class="menusep">▷</span><a class="Reference" href="146-27.html#sub:Misc...">Misc…↑</a></span> 
</div>
<div class="Standard">
	<div class="Standard">
		<div class="Description">
			<span class="Description-entry"><i>Operation</i></span> Selects one of the thirteen available operators (<i>see</i> <a class="Reference" href="146-29.html#tab:ImgCalculator">Image operations↓</a>). 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>Create New Window</i></span> If checked, a new image is created to hold the result. If unchecked, the result of the operation is applied directly to <i>Image1</i>. 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>32-bit (float) Result</i></span> If checked, source images will be converted to 32-bit floating point before performing the operation. 
		</div>
		<div class="Description">
			<span class="Description-entry"><i>Help</i></span> Opens <a class="URL" href="http://imagej.nih.gov/ij/docs/menus/process.html#calculator">http://imagej.nih.gov/ij/docs/menus/ process.html#calculator</a>. 
		</div>
	</div>
</div>
<div class="Standard">
	<div class="float">
		<a class="Label" name="tab:ImgCalculator"> </a>
		<div class="table">
			<div class="tablecaption">
				Table 6 <b><span class="menuitem"><a class="Reference" href="146-29.html#sub:Image-Calculator...">Image Calculator…↑</a></span> operations</b>.<b> </b>On these examples source and destination images (8-bit grayscale) are displayed with inverted LUTs (White<span class="formula"> = 0</span>; Black<span class="formula"> = 255</span>) (cf. <span class="menuitem"><a class="Reference" href="146-28.html#sub:Lookup-Tables">Lookup Tables<span class="menusep">▷</span>↑</a></span> submenu). Note that calculations between images can also be performed using copy and paste and the <span class="menuitem">Edit<span class="menusep">▷</span><a class="Reference" href="146-27.html#sub:Paste-Control...">Paste Control…↑</a></span> command. 
			</div>
			<table class="formal">
                <tr>
                  <td align="left" valign="middle" colspan="1"><strong>Source image</strong> (<span class="formula"><em>img</em>1</span>):</td>
                  <td align="left" valign="top"><img class="embedded c51" src="images/ImgCalculator/Source.png" alt="figure images/ImgCalculator/Source.png" /></td>
                  <td align="left" valign="middle" colspan="1"><strong>Destination image</strong> (<span class="formula"><em>img</em>2</span>):</td>
                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/Destination.png" alt="figure images/ImgCalculator/Destination.png" /></td>
                </tr>
                <tr class="header">
                  <td align="left" valign="top" colspan="4"> </td>
                </tr>
                <tr class="header">
                  <td align="center" valign="top" colspan="1"><strong>Operator</strong></td>
                  <td align="center" valign="top" colspan="1"><strong>Result</strong></td>
                  <td align="center" valign="top" colspan="1"><strong>Operator</strong></td>
                  <td align="center" valign="middle" colspan="1"><strong>Result</strong></td>
                </tr>

                <tr>
                  <td align="left" valign="middle"><strong>Add</strong>: <span class="formula"><em>img</em>1 = <em>img</em>1 + <em>img</em>2</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/Add.png" alt="figure images/ImgCalculator/Add.png" /></td>

                  <td align="left" valign="middle"><strong>Min</strong>: <span class="formula"><em>img</em>1 = min(<em>img</em>1, <em>img</em>2)</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/Min.png" alt="figure images/ImgCalculator/Min.png" /></td>
                </tr>

                <tr>
                  <td align="left" valign="middle"><strong>Subtract</strong>: <span class="formula"><em>img</em>1 = <em>img</em>1 − <em>img</em>2</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/Subtract.png" alt="figure images/ImgCalculator/Subtract.png" /></td>

                  <td align="left" valign="middle"><strong>Max</strong>: <span class="formula"><em>img</em>1 = max(<em>img</em>1, <em>img</em>2)</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/Max.png" alt="figure images/ImgCalculator/Max.png" /></td>
                </tr>

                <tr>
                  <td align="left" valign="middle"><strong>Multiply</strong>: <span class="formula"><em>img</em>1 = <em>img</em>1 × <em>img</em>2</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/Multiply.png" alt="figure images/ImgCalculator/Multiply.png" /></td>

                  <td align="left" valign="middle"><strong>Average</strong>: <span class="formula"><em>img</em>1 = (<em>img</em>1 + <em>img</em>2) ⁄ 2</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/Average.png" alt="figure images/ImgCalculator/Average.png" /></td>
                </tr>

                <tr>
                  <td align="left" valign="middle"><strong>Divide</strong>: <span class="formula"><em>img</em>1 = <em>img</em>1÷<em>img</em>2</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/Divide.png" alt="figure images/ImgCalculator/Divide.png" /></td>

                  <td align="left" valign="middle"><strong>Difference</strong>: <span class="formula"><em>img</em>1 = |<em>img</em>1 − <em>img</em>2|</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/Difference.png" alt="figure images/ImgCalculator/Difference.png" /></td>
                </tr>

                <tr>
                  <td align="left" valign="middle"><strong>AND</strong>: <span class="formula"><em>img</em>1 = <em>img</em>1∧<em>img</em>2</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/AND.png" alt="figure images/ImgCalculator/AND.png" /></td>

                  <td align="left" valign="middle"><strong>Copy</strong>: <span class="formula"><em>img</em>1 = <em>img</em>2</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/Destination.png" alt="figure images/ImgCalculator/Destination.png" /></td>
                </tr>

                <tr>
                  <td align="left" valign="middle"><strong>OR</strong>: <span class="formula"><em>img</em>1 = <em>img</em>1∨<em>img</em>2</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/OR.png" alt="figure images/ImgCalculator/OR.png" /></td>

                  <td align="left" valign="middle" colspan="1"><strong>Transparent--zero</strong></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/TranspZero.png" alt="figure images/ImgCalculator/TranspZero.png" /></td>
                </tr>

                <tr>
                  <td align="left" valign="middle"><strong>XOR</strong>: <span class="formula"><em>img</em>1 = <em>img</em>1⊕<em>img</em>2</span></td>

                  <td align="left" valign="middle"><img class="embedded c51" src="images/ImgCalculator/XOR.png" alt="figure images/ImgCalculator/XOR.png" /></td>

                  <td align="left" valign="middle" colspan="2"></td>
                </tr>
              </table>
		</div>
	</div>
</div>
<div class="See">
	<a class="URL" href="http://imagej.nih.gov/ij/plugins/calculator-plus.html">Calculator Plus</a> plugin 
</div>
<h2 class="Subsection">
	<a class="toc" name="toc-Subsection-29.14">29.14</a> <span class="menuitem">Subtract Background…</span><a class="Label" name="sub:Subtract-Background..."> </a> 
</h2>
<div class="Standard">
	Removes smooth continuous backgrounds from gels and other images <span class="bibcites">[<a class="bibliocite" name="cite-39" href="146-References.html#biblio-39">39</a>]</span>. Based on the concept of the &lsquo;rolling ball&rsquo; algorithm described in Sternberg Stanley, Biomedical image processing, <i>IEEE Computer</i>, Jan 1983). Imagine that the 2D grayscale image has a third dimension (height) by the image value at every point in the image, creating a surface. A ball of given radius is rolled over the bottom side of this surface; the hull of the volume reachable by the ball is the background to be subtracted.
	<div class="float">
		<a class="Label" name="Figure-35"> </a>
		<div class="figure" style="max-width: 90%;">
			<img class="figure" src="images/SubtractBackground.png" alt="figure images/SubtractBackground.png" style="width: 720px; height: 218px;" />
		<div class="caption">
			Figure 35 <span class="sans"><b>Process<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Subtract-Background...">Subtract Background…↑</a></b></span> This command uses a &lsquo;sliding paraboloid&rsquo; or a legacy &lsquo;rolling ball&rsquo; algorithm that can be used to correct uneven illuminated background as shown in the profiles (<span class="sans">Analyze<span class="menusep">▷</span><a class="Reference" href="146-30.html#sub:Plot-Profile-[k]"><span class="menuitem">Plot Profile [k]</span>↓</a></span>) below each image. <i>Rolling ball radius</i> should be set to at least the size of the largest object that is not part of the background. 
		</div>
	</div>
</div>
</div>
<div class="Description">
	<span class="Description-entry"><i>Rolling Ball Radius</i></span> The radius of curvature of the paraboloid. As a rule of thumb, for 8-bit or RGB images it should be at least as large as the radius of the largest object in the image that is not part of the background. Larger values will also work unless the background of the image is too uneven. For 16-bit and 32-bit images with pixel value ranges different from 0--255, the radius should be inversely proportional to the pixel value range (e.g., for 16-bit images (pixel values 0--65535), typical values of the radius are around 0.2 to 5). 
</div>
<div class="Description">
	<span class="Description-entry"><i>Light Background</i></span> Allows the processing of images with bright background and dark objects. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Separate Colors</i></span> (RGB images only) If unchecked, the operation will only affect the brightness, leaving the hue and saturation untouched. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Create</i> <i>Background (Don’t Subtract)</i></span> If checked, the output is not the image with the background subtracted but rather the background itself. This option is useful for examining the background created (in conjunction with the <i>Preview</i> option). <i>Create Background</i> can be also used for custom background subtraction algorithms where the image is duplicated and filtered (e.g. removing &lsquo;holes&rsquo; in the background) before creating the background and finally subtracting it with <span class="menuitem">Process<span class="menusep">▷</span><a class="Reference" href="146-29.html#sub:Image-Calculator...">Image Calculator…↑</a></span> 
</div>
<div class="Description">
	<span class="Description-entry"><i>Sliding</i> <i>Paraboloid</i></span> If checked, the &lsquo;rolling ball&rsquo; is replaced by a paraboloid that has the same curvature at the apex as a ball of that radius. This option allows any value of the radius<span class="formula"> &gt; 0.0001</span> (the &lsquo;rolling ball&rsquo; algorithm requires a radius of at least 1). The &lsquo;sliding paraboloid&rsquo; typically produces more reliable corrections since the &lsquo;rolling ball&rsquo;, a legacy algorithm (only kept for backward compatibility), is prone to edge artifacts.<br />
	To reduce the computing time the &lsquo;rolling ball&rsquo; algorithm downscales the image in a inconsistent way. The &lsquo;sliding paraboloid&rsquo; algorithm does not use downscaling and thus produces no downscaling artifacts. Nevertheless, the &lsquo;sliding paraboloid&rsquo; is also an approximation, since it does not use a <i>de facto</i> paraboloid (an exact implementation would require a great computing effort) but it rather slides parabolae in different directions over the image. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Disable Smoothing</i></span> For calculating the background (&lsquo;rolling the ball&rsquo;), images are maximum-filtered (3<span class="formula"> × </span>3 pixels) to remove outliers such as dust and then smoothed to reduce noise (average over (3<span class="formula"> × </span>3 pixels). With <i>Disable Smoothing</i> checked, the unmodified image data are used for creating the background. Check this option to make sure that the image data after subtraction will never be below the background. 
</div>
<div class="Description">
	<span class="Description-entry"><i>Help</i></span> Opens <a class="URL" href="http://imagej.nih.gov/ij/docs/menus/process.html#background">http://imagej.nih.gov/ij/docs/menus/process.html#background</a>. 
</div>
<div class="See">
	<a class="URL" href="http://imagejdocu.tudor.lu/doku.php?id=howto:working:how_to_correct_background_illumination_in_brightfield_microscopy">How to correct background illumination in brightfield microscopy</a> by G. Landini, <a class="URL" href="http://fiji.sc/wiki/index.php/Auto_Local_Threshold">Auto Local Threshold</a>, command’s <a class="URL" href="http://rsbweb.nih.gov/ij/developer/source/ij/plugin/filter/BackgroundSubtracter.java.html">source code</a>, <a class="URL" href="http://imagej.nih.gov/ij/plugins/rolling-ball.html">Rolling Ball Background Subtraction</a> (the plugin that implemented this command in versions up to 1.39e) 
</div>
<h2 class="Subsection">
	<a class="toc" name="toc-Subsection-29.15">29.15</a> <span class="menuitem">Repeat Command [R]</span><a class="Label" name="sub:Repeat-Command-[R]"> </a> 
</h2>
<div class="Standard">
	Reruns the previous command. The <span class="menuitem">Edit<span class="menusep">▷</span>Undo</span> and <span class="menuitem">File<span class="menusep">▷</span>Open</span> commands are skipped. 
</div>
<div class="See">
	<a class="Reference" href="146-6.html#sec:Undo-and-Redo">Undo and Redo↑</a> 
</div>
<div class="Standard">
	<p>
		<br />
	</p>
</div>
<div class="bottomheader">
	<span class="prev"><a class="prev" name="prev" href="146-28.html">Prev</a> Sec. 28: Image<span class="menusep">▷</span></span> <span class="up"><a class="up" name="up" href="146-Part-V.html">Up</a> Part V: Menu Commands</span> <span class="next">Sec. 30: Analyze<span class="menusep">▷</span> <a class="next" name="next" href="146-30.html">Next</a></span> 
</div>
<div id="footer">
	Last modified: 2012-06-27 <a href="#" style="float:right">Top</a> 
</div>
</div>
</div>
</body>
</html>
